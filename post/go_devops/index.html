<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Devops - Morgoth</title>
    <meta name="description" content="">
    
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: #fff;
            padding: 1rem 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 2rem;
        }
        nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        nav a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
        }
        nav a:hover {
            color: #007acc;
        }
        .site-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007acc;
        }
        main {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .post-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .post-content h1, .post-content h2, .post-content h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        .post-list {
            list-style: none;
            padding: 0;
        }
        .post-list li {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .post-list h2 {
            margin: 0 0 0.5rem 0;
        }
        .post-list h2 a {
            text-decoration: none;
            color: #333;
        }
        .post-list h2 a:hover {
            color: #007acc;
        }
        footer {
            text-align: center;
            padding: 2rem 0;
            color: #666;
            border-top: 1px solid #ddd;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="https://canuxcheng.com/" class="site-title">Morgoth</a>
                
                    <a href="/">Home</a>
                
                    <a href="/about/">About</a>
                
                    <a href="/categories/">Categories</a>
                
                    <a href="/tags/">Tags</a>
                
                    <a href="/rtfm/">RTFM</a>
                
                    <a href="/samuel/">Samuel</a>
                
            </nav>
        </div>
    </header>
    
    <div class="container">
        <main>
            
<div class="single-post">
    <article>
        <header>
            <h1>Devops</h1>
            <div class="post-meta">
                <time>January 1, 2018</time>
                
                    
                        <span class="category">Golang</span>
                    
                
                
                    
                        <span class="tag">#devops</span>
                    
                
            </div>
        </header>
        
        <div class="post-content">
            <h1 id="go">Go</h1>
<p>go有三种安装方式：</p>
<ol>
<li>源码安装</li>
<li>标准包安装</li>
<li>第三方工具安装</li>
</ol>
<p>GOROOT:</p>
<pre><code>GOROOT 就是go的安装目录
</code></pre>
<p>windows标准包安装go:</p>
<pre><code>msi指定安装路径，自动添加%GOROOT%/bin到环境变量
</code></pre>
<p>linux标准包安装go:</p>
<pre><code>下载.tar.gz包解压到/usr/local/go
GOROOT=/usr/local/go
export PATH=$PATH:/usr/local/go/bin
</code></pre>
<p>验证安装：</p>
<pre><code>$ go --help
$ go version
</code></pre>
<p>第三方工具gvm安装go:</p>
<p><a href="http://github.com/moovweb/gvm">http://github.com/moovweb/gvm</a></p>
<pre><code>$ gvm install go1.9.2
$ gvm use go1.9.2
</code></pre>
<hr>
<h1 id="gopath">GOPATH</h1>
<p>gopath用来存放go源码，go的可运行文件，以及相应的编译之后的包文件．</p>
<p>GOPATH 从go1.1到1.7都需要设置，而且不能是go的安装目录, go1.8开始有默认值:</p>
<pre><code>GOPATH=$USERPROFILE%go
GOPATH=$HOME/go
</code></pre>
<p>gopath结构：</p>
<pre><code>src    存放源码
pkg    编译后的库文件
bin    编译后生成的可执行文件
</code></pre>
<p>gopath有多个值时用冒号分开即可.</p>
<h1 id="gobin">GOBIN</h1>
<p>默认值</p>
<pre><code>GOBIN=$HOME/go/bin
export PATH=$PATH:$HOME/go/bin
</code></pre>
<p>go get 和 go install 安装的二进制到GOBIN。</p>
<hr>
<h1 id="go命令">go命令</h1>
<pre><code>$ go help [command]
</code></pre>
<p>get</p>
<p>下载并安装包和依赖, 也就是安装第三方的库．</p>
<pre><code>$ go get [...] [packages]

&gt; go get安装第三方包如果出现依赖无法安装，可以通过github下载．
$ cd golang.org/x
$ git clone https://github.com/golang/crypto.git crypto
$ go install golang.org/x/crypto/ssh

go get -u (without any arguments) now only upgrades the direct and indirect dependencies of your current package, and no longer examines your entire module.

go get -u ./... from your module root upgrades all the direct and indirect dependencies of your module, and now excludes test dependencies.

go get -u -t ./... is similar, but also upgrades test dependencies.
</code></pre>
<p>build</p>
<p>编译包和依赖</p>
<pre><code>$ go build [-o output] [-i] [build flags] [packages]
</code></pre>
<p>install</p>
<p>编译并安装包和依赖</p>
<pre><code>$ go install [build flags] [packages]
</code></pre>
<p>run</p>
<p>编译并运行程序</p>
<pre><code>$ go run [...] gofiles... [...]
</code></pre>
<p>fmt</p>
<p>格式化代码和文档：</p>
<pre><code>$ go fmt [...] [packages]
</code></pre>
<p>vet</p>
<p>检测代码常见错误:</p>
<pre><code>$ go vet [-n] [-x] [build flags] [vet flags] [packages]
</code></pre>
<p>test</p>
<p>测试包:</p>
<pre><code>$ go test [...] [packages] [...]
</code></pre>
<p>doc</p>
<p>查看文档：</p>
<pre><code>$ go doc [package/symbol]
</code></pre>
<p>tool</p>
<p>运行工具:</p>
<pre><code>$ go tool [-n] command [args...]

addr2line

asm

buildid

cgo

// 查看汇编代码
compile
go tool compile -S pkg.go

cover
dist
doc
fix
link
nm
objdump
pack
pprof
test2json
trace
vet
</code></pre>
<p>mod</p>
<pre><code>go mod init &lt;name&gt;
go mod tidy // 添加缺少的，删除多余的.
go mod download // 下载包
go mod verify 
go mod edit
go mod graph
go mod why
go mod vendor
</code></pre>
<p>env</p>
<pre><code>// 通过env 设置golang的变量，取代系统环境变量
go env
go env -w GOROOT=&quot;/usr/local/go&quot;
go env -w GOPATH=&quot;$HOME/go&quot;
go env -w GOBIN=&quot;$HOME/go/bin&quot;
go env -w GO111MODULE=on
</code></pre>
<p>clean</p>
<pre><code>go clean -cache
go clean -modcache
</code></pre>
<hr>
<h1 id="安装第三方包">安装第三方包</h1>
<p>go get的功能很有限．</p>
<p>godep和golide都会被官方的dep取代．</p>
<h2 id="depdeprecated">dep(deprecated)</h2>
<p><a href="https://github.com/golang/dep">https://github.com/golang/dep</a></p>
<p>无法解决GFW的问题.</p>
<p>安装：</p>
<pre><code>$ go get -u github.com/golang/dep/cmd/dep
</code></pre>
<p>go官方包管理器</p>
<pre><code># 初始化一个使用dep管理包的项目，
# 创建Gopkg.toml, Gopkg.lock, vendor/
$ dep init

$ dep status

$ dep prune

$ dep ensure
$ dep ensure -update
</code></pre>
<h2 id="module">module</h2>
<p>vgo已经集成到go1.11</p>
<p>通过go mod init初始化两个文件.</p>
<p>go.mod:</p>
<pre><code>module
go
require
exclude
replace

// 使用本地module,或使用指定repo里面的module
replace github.com/crazy-canux/go-devops =&gt; /path/to/local/github.com/crazy-canux/go-devops
</code></pre>
<p>go.sum:</p>
<pre><code>go env -w GOSUMDB=off
</code></pre>
<p>设置相关环境变量:</p>
<pre><code>GO111MODULE:
// auto/on/off
go env -w GO111MODULE=on

GOPROXY:
go env -w GOPROXY=https://goproxy.cn,direct
https://proxy.golang.org //默认值
https://goproxy.cn
https://goproxy.io
https://mirrors.aliyun.com/goproxy/

GOSUMDB:

GOPRIVATE

GONOPROXY

GONOSUMDB
</code></pre>
<hr>
<h1 id="项目结构">项目结构</h1>
<pre><code>cmd: 可执行文件入口
pkg: 核心代码库
api: api的spec, openapi/swagger/json/protocol/grpc
hack: 构建/测试相关脚本
plugin: 插件
staging: wip
third_party: 第三方工具/代码
vendor: 项目依赖
build
test
docs
</code></pre>
<p>没有子目录包结构：</p>
<pre><code>go-devops
    |- README.md
    |- doc.go
    |- grafana.go
    |- grafana_test.go
    ...

import &quot;go-devops&quot;
</code></pre>
<p>有子目录的包结构：</p>
<pre><code>go-devops
    |- README.md
    |- doc.go // package go_devops
    |- grafana
       |- doc.go // package grafana
       |- grafana.go
       |- grafana_test.go

import &quot;go-devops/grafana&quot;
</code></pre>
<hr>
<h1 id="proxy">proxy</h1>
<p>goproxy.io</p>
<p><a href="https://github.com/goproxyio/goproxy">https://github.com/goproxyio/goproxy</a></p>
<p>goproxy.cn</p>
<p><a href="https://github.com/goproxy/goproxy.cn">https://github.com/goproxy/goproxy.cn</a></p>

        </div>
    </article>
</div>

        </main>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Morgoth. Designed by Canux</p>
        </div>
    </footer>
</body>
</html>
