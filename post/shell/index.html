<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shell - Morgoth</title>
    <meta name="description" content="">
    
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: #fff;
            padding: 1rem 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 2rem;
        }
        nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        nav a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
        }
        nav a:hover {
            color: #007acc;
        }
        .site-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007acc;
        }
        main {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .post-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .post-content h1, .post-content h2, .post-content h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        .post-list {
            list-style: none;
            padding: 0;
        }
        .post-list li {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .post-list h2 {
            margin: 0 0 0.5rem 0;
        }
        .post-list h2 a {
            text-decoration: none;
            color: #333;
        }
        .post-list h2 a:hover {
            color: #007acc;
        }
        footer {
            text-align: center;
            padding: 2rem 0;
            color: #666;
            border-top: 1px solid #ddd;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="https://canuxcheng.com/" class="site-title">Morgoth</a>
                
                    <a href="/">Home</a>
                
                    <a href="/about/">About</a>
                
                    <a href="/categories/">Categories</a>
                
                    <a href="/tags/">Tags</a>
                
                    <a href="/rtfm/">RTFM</a>
                
                    <a href="/samuel/">Samuel</a>
                
            </nav>
        </div>
    </header>
    
    <div class="container">
        <main>
            
<div class="single-post">
    <article>
        <header>
            <h1>Shell</h1>
            <div class="post-meta">
                <time>April 1, 2016</time>
                
                    
                        <span class="category">Linux</span>
                    
                
                
                    
                        <span class="tag">#shell</span>
                    
                
            </div>
        </header>
        
        <div class="post-content">
            <h1 id="shell">Shell</h1>
<p>Linux的shell有很多种,大多数linux发行版的默认登录shell是BASH。</p>
<p>查看当前使用的shell：</p>
<pre><code>echo $SHELL
echo $0
</code></pre>
<p>查看安装了哪些shell：</p>
<pre><code>cat /etc/shells
</code></pre>
<p>设置登陆shell:</p>
<pre><code>$chsh -s $(which shellname)
</code></pre>
<p>shell分为登陆shell和交互式shell:</p>
<pre><code># 输出有i的就是交互shell
$echo $-
</code></pre>
<p>非交互登陆shell:</p>
<ul>
<li>先运行系统配置文件/etc/profile(调用/etc/bash.bashrc和/etc/profile.d/*.sh)</li>
<li>然后运行用户配置文件~/.profile(调用~/.bashrc和~/bin)</li>
<li>最后退出用户登陆~/.bash_logout</li>
</ul>
<p>交互非登陆shell:</p>
<ul>
<li>先运行/etc/bash.bashrc(调用/etc/bash_completion(调用/etc/bash_completion.d/*.sh))</li>
<li>然后运行~/.bashrc(调用~/.bash_aliases和~/bash.d和~/bin)</li>
</ul>
<hr>
<h1 id="shell相关项目">shell相关项目</h1>
<h2 id="bash-it">bash-it</h2>
<p>大部分发行版默认使用bash,无需额外安装。</p>
<p>bash的优化项目bash-it：</p>
<p><a href="https://github.com/Bash-it/bash-it">https://github.com/Bash-it/bash-it</a></p>
<h2 id="zsh">zsh</h2>
<p><a href="http://www.zsh.org/">http://www.zsh.org/</a></p>
<h2 id="oh-my-zsh">oh-my-zsh</h2>
<p><a href="https://github.com/robbyrussell/oh-my-zsh">https://github.com/robbyrussell/oh-my-zsh</a></p>
<h2 id="fish-shell">fish-shell</h2>
<p><a href="https://github.com/fish-shell/fish-shell">https://github.com/fish-shell/fish-shell</a></p>
<h2 id="oh-my-fish">oh-my-fish</h2>
<p><a href="https://github.com/oh-my-fish/oh-my-fish">https://github.com/oh-my-fish/oh-my-fish</a></p>
<h2 id="thefuck">thefuck</h2>
<p>一个纠正shell命令输错的命令</p>
<p><a href="https://github.com/nvbn/thefuck">https://github.com/nvbn/thefuck</a></p>
<h2 id="shellcheck">shellcheck</h2>
<p>一个debug脚本的工具．</p>
<p><a href="https://github.com/koalaman/shellcheck">https://github.com/koalaman/shellcheck</a></p>
<hr>
<h1 id="shell-script">shell script</h1>
<p>基本语法</p>
<pre><code>#!/usr/bin/env bash

command1 &amp;&amp; command2    # 当command1执行成功（返回0)才会执行command2
command1 || command2    # 当command1执行失败（返回非0)才会执行command2
</code></pre>
<h2 id="shell注释">shell注释</h2>
<p>单行注释：</p>
<pre><code># comment
</code></pre>
<p>多行注释：</p>
<pre><code>:&lt;&lt;!EOF!
comment
!EOF! can be any symbol and character.
!EOF!
</code></pre>
<h2 id="shell关键字和特殊符号">shell关键字和特殊符号</h2>
<p>三个特殊命令</p>
<pre><code>echo
printf
test
</code></pre>
<p>关键字</p>
<pre><code>function
</code></pre>
<h2 id="shell运算符和优先级">shell运算符和优先级</h2>
<p>原生shell不支持数学运算，可以通过expr来实现．</p>
<pre><code># expr表达式内部运算符前后要空格.
val=`expr 2 + 2`
</code></pre>
<p>算术运算符</p>
<pre><code>+
-
*    # `expr $a \* $b`, 不要转义
/
%
=     # a=$b
==    # [ $a == $b ] , 需要中括号，需要空格
!=    # [ $a != $b ], 同上
</code></pre>
<p>关系运算符</p>
<pre><code># 只支持数字，不支持字符串．需要中括号和空格
-eq
-ne
-gt
-lt
-ge
-le
</code></pre>
<p>布尔运算符</p>
<pre><code># 符合短路和斷路原则
!     # [ !false ]
-o    # [ exp1 -o exp2 ], 有一个为true就返回true
-a    # [ exp1 -a exp2], 两个都是true才返回true
</code></pre>
<p>逻辑运算</p>
<pre><code>||
&amp;&amp;
</code></pre>
<p>字符串运算符</p>
<pre><code>=
!=
-Z    # 字符串长度为0返回true
-n    # 字符串长度为0返回false
str    # [ $a ], 字符串不为空返回true
</code></pre>
<p>文件测试运算符</p>
<pre><code>-b
-c
-d
-f
-g
-k
-p
-u
-r
-w
-x
-s
-e
</code></pre>
<h2 id="shell数据结构和变量">shell数据结构和变量</h2>
<p>变量类型：</p>
<pre><code>局部变量
环境变量
shell变量
</code></pre>
<p>定义变量:</p>
<pre><code>等号前后不能有空格
不能用数字开头命名变量
不能用标点符号和关键字

var=`ls /etc`  # 返回的是stdout+stderr
var=$(ls /etc) # 返回的是stdou+stderr
</code></pre>
<p>使用变量：</p>
<pre><code>$var
${var}

# 使用双引号
var1=&quot;pre${var}suf
var2=&quot;$var&quot;
</code></pre>
<p>只读变量:</p>
<pre><code>使用readonly定义只读变量，不能再重新赋值

var=value
readonly var
</code></pre>
<p>删除变量:</p>
<pre><code>使用unset删除变量，被删除的变量不能使用.

var=value
unset var
</code></pre>
<p>变量操作：</p>
<pre><code>${var/old/new} # 将变量中的old替换成new.
${var:start:end} # 获取变量的start到end个字符，相当于var[start:end],下标从0开始.
</code></pre>
<p>字符串类型：</p>
<pre><code>单引号的字符串是原样输出，其中的变量是无效的，里面不能有单引号.
var='this is string'

双引号的字符串里面可以有变量，可以出现转义字符.
var=&quot;this is string&quot;
&quot;outer \&quot;inner string\&quot; string&quot;

获取字符串长度
var=&quot;this is tring&quot;
echo ${#var}

字符串切片
var=&quot;this is string&quot;
${var:start:end}    # 相当于var[start:end], 下标从0开始

获取pattern在string中的起始下标
string=&quot;this is string&quot;
`expr index &quot;$string&quot; pattern`
</code></pre>
<p>数字类型：</p>
<p>数组:</p>
<h2 id="shell控制流">shell控制流</h2>
<pre><code># [[ 里面不能用 -o/-a ]]
if [[ $status1 -eq 0 ]] || [[  $status2 -eq 0 ]]
if [[ $status1 -eq 0 ]] &amp;&amp; [[  $status2 -eq 0 ]]
# [ 单层可以用-o/-a ]
if [ $status1 -eq 0 -o $status2 -eq 0 ]
</code></pre>
<p>if</p>
<pre><code>if []; then command; ...; fi

if condition
then
    command
fi

[]/test 中必须为执行的命令的stdout+stderr.
if [ ! `cat file | grep pattern | wc -l` ]
if [ ! 0 ] 此时0为真, [ ! 0 ]为假

if command 看返回码$?, 0表示真,其它表示假.
</code></pre>
<p>if-else</p>
<pre><code>if condition; then command; ...; else command; fi

if condition
then
    command
else
    command
fi
</code></pre>
<p>if-elif-else</p>
<pre><code>if condition; then command; ...; elif condition; then command; ...; else command; fi

if condition
then
    command
elif condition
then
    command
else
    command
fi
</code></pre>
<p>while</p>
<pre><code>while condition; do command;...; done

while condition
do
    command
done

# 无限循环
while :
do
    command
done

# 无限循环
while true
do
    command
done
</code></pre>
<p>for</p>
<pre><code>for ((i=1; i&lt;=100; i++))
for i in {1..100}
for i in `seq 1 100`

for VAR in ${1,2,3,...}; do command; ...; done

for var in item1 item2 ... itemN
do
    command
done

# 无限循环
for (( ; ; ))
</code></pre>
<p>until</p>
<pre><code>until condition; do command; ...; done

until condition
do
    command
done
</code></pre>
<p>case</p>
<pre><code>case $VAR in
val1)
    command
    ...
    ;;
val2)
    command
    ...
    ;;
esac
</code></pre>
<p>break</p>
<p>continue</p>
<h2 id="shell函数">shell函数</h2>
<p>return只是返回当前函数，不退出主程序</p>
<p>exit直接退出主程序</p>
<p>通过关键字function定义函数:</p>
<pre><code>function Name {    // ()可省略
function Name() {
    ...
    # 如果不显示调用return返回，则函数返回最后一条命令的结果
    return $?
}
</code></pre>
<p>也可以直接定义函数:</p>
<pre><code>Name() {
    ...
}
</code></pre>
<p>函数返回码:</p>
<pre><code>$?
</code></pre>
<p>函数参数：</p>
<pre><code>$1 - $9 可以在函数内部获取调用函数时候传递进来的９个参数
${10} - ${100} 获取第十个参数和后面的参数
</code></pre>
<p>特殊字符：</p>
<pre><code>$# 表示传递到脚本的参数个数,不包括程序本身
$* 传入所有参数
$@ 传入所有参数
$$
$!
$-
</code></pre>
<h2 id="输入输出和重定向">输入输出和重定向</h2>
<p>stdout和stdin重定向到一个地方:</p>
<pre><code>1&gt; 只重定向stdout
2&gt; 只重定向stderr
2&gt;&amp;1 同时重定向stdout+stderr

main &gt; 2&gt;&amp;1 log1.log | tee log2.log # 同时重定向到两个文件
main 2&gt;&amp;1 | tee ${LOG} # 同时将stdout和stderr输出到终端和日志文件.
</code></pre>
<h2 id="文件包含">文件包含</h2>

        </div>
    </article>
</div>

        </main>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Morgoth. Designed by Canux</p>
        </div>
    </footer>
</body>
</html>
