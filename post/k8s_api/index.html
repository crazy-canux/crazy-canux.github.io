<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='API api-serverÁªü‰∏ÄÁöÑÊìç‰ΩúÂÖ•Âè£.
kubectl, UI, Á≠âÈÉΩÊòØÈÄöËøáapi-serverÊìç‰ΩúËµÑÊ∫ê.
payloadÂèØ‰ª•ÊòØjsonÔºå‰πüÂèØ‰ª•ÊòØyaml.
yamlÊñá‰ª∂‰∏≠#Ë°®Á§∫Ë°åÊ≥®Èáä„ÄÇ
yaml ÈÉ®ÁΩ≤k8sÂèØ‰ª•ÈÄöËøáyamlÊñá‰ª∂Êù•ÈÖçÁΩÆËµÑÊ∫ê.
ËµÑÊ∫êÂØπË±°ÁªÑÊàêÈÉ®ÂàÜ:
apiVersion: kind: metadata: ÂÖÉÊï∞ÊçÆ spec: ÊúüÊúõÁöÑÁä∂ÊÄÅ status: ËßÇÊµãÂà∞ÁöÑÁä∂ÊÄÅ Êü•ÁúãapiVersion:
kubectl api-versions Êü•ÁúãKind:
kubectl api-resources # In a namespace kubectl api-resources --namespaced=true # Not in a namespace kubectl api-resources --namespaced=false metadata:
metadata: name: namespace: labels/Ê†áÁ≠æ: Áî®Êà∑Á≠õÈÄâËµÑÊ∫êÔºåÂîØ‰∏ÄÁöÑËµÑÊ∫êÁªÑÂêàÊñπÊ≥ï, ÂèØ‰ª•‰ΩøÁî®selectorÊù•Êü•ËØ¢. annotations/Ê≥®Ëß£: Â≠òÂÇ®ËµÑÊ∫êÁöÑÈùûÊ†áËØÜÊÄß‰ø°ÊÅØÔºåÊâ©Â±ïËµÑÊ∫êÁöÑspec/status. ownerReference/ÂÖ≥Á≥ª: Êñπ‰æøÂèçÂêëÊü•ÊâæÂàõÂª∫ËµÑÊ∫êÁöÑÂØπË±°ÔºåÊñπ‰æøËøõË°åÁ∫ßËÅîÂà†Èô§„ÄÇ spec:
status:
Ë∞ÉÂ∫¶ÔºåÊä¢Âç†ÔºåÈ©±ÈÄê taints: Ê±°ÁÇπÔºå‰ΩøËäÇÁÇπÊéíÊñ•ÁâπÂÆöpod„ÄÇÂ∫îÁî®‰∫énode„ÄÇÂä†‰∫ÜtolerationsÊàñËÄÖaffinityÁöÑpodÊâçËÉΩË∞ÉÂ∫¶ËøáÊù•„ÄÇ
taints: - effect: NoSchedule key: kubernetes.io/arch value: arm64 tolerations: ÂÆπÂøçÂ∫¶Ôºå‰ΩøpodËÉΩÂÆπÂøçÂä†‰∫ÜtraintsÁöÑËäÇÁÇπ„ÄÇÂ∫îÁî®‰∫épod„ÄÇ Ëøô‰∏™Âè™ËÉΩËÆ©podËÉΩÈÉ®ÁΩ≤Âà∞Âä†‰∫ÜÊ±°ÁÇπÁöÑnodeÔºåpod‰πüËÉΩÈÉ®ÁΩ≤Âà∞ÂÖ∂ÂÆÉÊ≤°ÊúâÂä†Ê±°ÁÇπÁöÑnode„ÄÇ
'>
<title>K8S API</title>

<link rel='canonical' href='https://canuxcheng.com/post/k8s_api/'>

<link rel="stylesheet" href="/scss/style.min.2d59822570c0be136f2ad87c952ef8788ac2a951067adda1c49b253bff7d0292.css"><meta property='og:title' content='K8S API'>
<meta property='og:description' content='API api-serverÁªü‰∏ÄÁöÑÊìç‰ΩúÂÖ•Âè£.
kubectl, UI, Á≠âÈÉΩÊòØÈÄöËøáapi-serverÊìç‰ΩúËµÑÊ∫ê.
payloadÂèØ‰ª•ÊòØjsonÔºå‰πüÂèØ‰ª•ÊòØyaml.
yamlÊñá‰ª∂‰∏≠#Ë°®Á§∫Ë°åÊ≥®Èáä„ÄÇ
yaml ÈÉ®ÁΩ≤k8sÂèØ‰ª•ÈÄöËøáyamlÊñá‰ª∂Êù•ÈÖçÁΩÆËµÑÊ∫ê.
ËµÑÊ∫êÂØπË±°ÁªÑÊàêÈÉ®ÂàÜ:
apiVersion: kind: metadata: ÂÖÉÊï∞ÊçÆ spec: ÊúüÊúõÁöÑÁä∂ÊÄÅ status: ËßÇÊµãÂà∞ÁöÑÁä∂ÊÄÅ Êü•ÁúãapiVersion:
kubectl api-versions Êü•ÁúãKind:
kubectl api-resources # In a namespace kubectl api-resources --namespaced=true # Not in a namespace kubectl api-resources --namespaced=false metadata:
metadata: name: namespace: labels/Ê†áÁ≠æ: Áî®Êà∑Á≠õÈÄâËµÑÊ∫êÔºåÂîØ‰∏ÄÁöÑËµÑÊ∫êÁªÑÂêàÊñπÊ≥ï, ÂèØ‰ª•‰ΩøÁî®selectorÊù•Êü•ËØ¢. annotations/Ê≥®Ëß£: Â≠òÂÇ®ËµÑÊ∫êÁöÑÈùûÊ†áËØÜÊÄß‰ø°ÊÅØÔºåÊâ©Â±ïËµÑÊ∫êÁöÑspec/status. ownerReference/ÂÖ≥Á≥ª: Êñπ‰æøÂèçÂêëÊü•ÊâæÂàõÂª∫ËµÑÊ∫êÁöÑÂØπË±°ÔºåÊñπ‰æøËøõË°åÁ∫ßËÅîÂà†Èô§„ÄÇ spec:
status:
Ë∞ÉÂ∫¶ÔºåÊä¢Âç†ÔºåÈ©±ÈÄê taints: Ê±°ÁÇπÔºå‰ΩøËäÇÁÇπÊéíÊñ•ÁâπÂÆöpod„ÄÇÂ∫îÁî®‰∫énode„ÄÇÂä†‰∫ÜtolerationsÊàñËÄÖaffinityÁöÑpodÊâçËÉΩË∞ÉÂ∫¶ËøáÊù•„ÄÇ
taints: - effect: NoSchedule key: kubernetes.io/arch value: arm64 tolerations: ÂÆπÂøçÂ∫¶Ôºå‰ΩøpodËÉΩÂÆπÂøçÂä†‰∫ÜtraintsÁöÑËäÇÁÇπ„ÄÇÂ∫îÁî®‰∫épod„ÄÇ Ëøô‰∏™Âè™ËÉΩËÆ©podËÉΩÈÉ®ÁΩ≤Âà∞Âä†‰∫ÜÊ±°ÁÇπÁöÑnodeÔºåpod‰πüËÉΩÈÉ®ÁΩ≤Âà∞ÂÖ∂ÂÆÉÊ≤°ÊúâÂä†Ê±°ÁÇπÁöÑnode„ÄÇ
'>
<meta property='og:url' content='https://canuxcheng.com/post/k8s_api/'>
<meta property='og:site_name' content='Morgoth'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='k8s' /><meta property='article:published_time' content='2020-01-10T20:55:52&#43;08:00'/><meta property='article:modified_time' content='2020-01-10T20:55:52&#43;08:00'/>
<meta name="twitter:title" content="K8S API">
<meta name="twitter:description" content="API api-serverÁªü‰∏ÄÁöÑÊìç‰ΩúÂÖ•Âè£.
kubectl, UI, Á≠âÈÉΩÊòØÈÄöËøáapi-serverÊìç‰ΩúËµÑÊ∫ê.
payloadÂèØ‰ª•ÊòØjsonÔºå‰πüÂèØ‰ª•ÊòØyaml.
yamlÊñá‰ª∂‰∏≠#Ë°®Á§∫Ë°åÊ≥®Èáä„ÄÇ
yaml ÈÉ®ÁΩ≤k8sÂèØ‰ª•ÈÄöËøáyamlÊñá‰ª∂Êù•ÈÖçÁΩÆËµÑÊ∫ê.
ËµÑÊ∫êÂØπË±°ÁªÑÊàêÈÉ®ÂàÜ:
apiVersion: kind: metadata: ÂÖÉÊï∞ÊçÆ spec: ÊúüÊúõÁöÑÁä∂ÊÄÅ status: ËßÇÊµãÂà∞ÁöÑÁä∂ÊÄÅ Êü•ÁúãapiVersion:
kubectl api-versions Êü•ÁúãKind:
kubectl api-resources # In a namespace kubectl api-resources --namespaced=true # Not in a namespace kubectl api-resources --namespaced=false metadata:
metadata: name: namespace: labels/Ê†áÁ≠æ: Áî®Êà∑Á≠õÈÄâËµÑÊ∫êÔºåÂîØ‰∏ÄÁöÑËµÑÊ∫êÁªÑÂêàÊñπÊ≥ï, ÂèØ‰ª•‰ΩøÁî®selectorÊù•Êü•ËØ¢. annotations/Ê≥®Ëß£: Â≠òÂÇ®ËµÑÊ∫êÁöÑÈùûÊ†áËØÜÊÄß‰ø°ÊÅØÔºåÊâ©Â±ïËµÑÊ∫êÁöÑspec/status. ownerReference/ÂÖ≥Á≥ª: Êñπ‰æøÂèçÂêëÊü•ÊâæÂàõÂª∫ËµÑÊ∫êÁöÑÂØπË±°ÔºåÊñπ‰æøËøõË°åÁ∫ßËÅîÂà†Èô§„ÄÇ spec:
status:
Ë∞ÉÂ∫¶ÔºåÊä¢Âç†ÔºåÈ©±ÈÄê taints: Ê±°ÁÇπÔºå‰ΩøËäÇÁÇπÊéíÊñ•ÁâπÂÆöpod„ÄÇÂ∫îÁî®‰∫énode„ÄÇÂä†‰∫ÜtolerationsÊàñËÄÖaffinityÁöÑpodÊâçËÉΩË∞ÉÂ∫¶ËøáÊù•„ÄÇ
taints: - effect: NoSchedule key: kubernetes.io/arch value: arm64 tolerations: ÂÆπÂøçÂ∫¶Ôºå‰ΩøpodËÉΩÂÆπÂøçÂä†‰∫ÜtraintsÁöÑËäÇÁÇπ„ÄÇÂ∫îÁî®‰∫épod„ÄÇ Ëøô‰∏™Âè™ËÉΩËÆ©podËÉΩÈÉ®ÁΩ≤Âà∞Âä†‰∫ÜÊ±°ÁÇπÁöÑnodeÔºåpod‰πüËÉΩÈÉ®ÁΩ≤Âà∞ÂÖ∂ÂÆÉÊ≤°ÊúâÂä†Ê±°ÁÇπÁöÑnode„ÄÇ
">
    <link rel="shortcut icon" href="favicon.ico" />
<style>
    :root {
        --article-font-family: "Merriweather", var(--base-font-family);
    }
</style>

<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap";
    
        customFont.type = "text/css";
        customFont.rel = "stylesheet";
    
        document.head.appendChild(customFont);
    }());
</script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/home_hu_ee27fe234e3b32c2.jpg" width="300"
                            height="400" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Morgoth</a></h1>
            <h2 class="site-description">Hello World!</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='mailto:canuxcheng@163.com'
                        target="_blank"
                        title="E-mail"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10" />
  <path d="M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/crazy-canux'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories/' target="_blank">
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                
                <span>Categories</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags/' target="_blank">
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



                
                <span>Tags</span>
            </a>
        </li>
        
        
        <li >
            <a href='/rtfm/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                
                <span>RTFM</span>
            </a>
        </li>
        
        
        <li >
            <a href='/samuel/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>



                
                <span>Samuel</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://canuxcheng.com/" selected></option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#yaml">yaml</a></li>
    <li><a href="#Ë∞ÉÂ∫¶Êä¢Âç†È©±ÈÄê">Ë∞ÉÂ∫¶ÔºåÊä¢Âç†ÔºåÈ©±ÈÄê</a></li>
    <li><a href="#ÂÆâÂÖ®">ÂÆâÂÖ®</a></li>
  </ul>

  <ul>
    <li><a href="#externalname-service">ExternalName Service</a></li>
    <li><a href="#endpoint">Endpoint</a></li>
  </ul>

  <ul>
    <li><a href="#serviceaccont">ServiceAccont</a></li>
    <li><a href="#role">Role</a></li>
    <li><a href="#rolebinding">RoleBinding</a></li>
    <li><a href="#clusterrole">ClusterRole</a></li>
    <li><a href="#clusterrolebinding">ClusterRoleBinding</a></li>
    <li><a href="#admission-controllers">Admission Controllers</a>
      <ul>
        <li><a href="#mutatingadmissionwebhook">MutatingAdmissionWebhook</a></li>
        <li><a href="#validatingadmissionwebhook">ValidatingAdmissionWebhook</a></li>
        <li><a href="#validatingwebhookconfiguration">ValidatingWebhookConfiguration</a></li>
        <li><a href="#mutatingwebhookconfiguration">MutatingWebhookConfiguration</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/cncf/" >
                CNCF
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/k8s_api/">K8S API</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 10, 2020</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="api">API</h1>
<p>api-serverÁªü‰∏ÄÁöÑÊìç‰ΩúÂÖ•Âè£.</p>
<p>kubectl, UI, Á≠âÈÉΩÊòØÈÄöËøáapi-serverÊìç‰ΩúËµÑÊ∫ê.</p>
<p>payloadÂèØ‰ª•ÊòØjsonÔºå‰πüÂèØ‰ª•ÊòØyaml.</p>
<p>yamlÊñá‰ª∂‰∏≠#Ë°®Á§∫Ë°åÊ≥®Èáä„ÄÇ</p>
<hr>
<h2 id="yaml">yaml</h2>
<p>ÈÉ®ÁΩ≤k8sÂèØ‰ª•ÈÄöËøáyamlÊñá‰ª∂Êù•ÈÖçÁΩÆËµÑÊ∫ê.</p>
<p>ËµÑÊ∫êÂØπË±°ÁªÑÊàêÈÉ®ÂàÜ:</p>
<pre><code>apiVersion: 
kind: 
metadata: ÂÖÉÊï∞ÊçÆ
spec: ÊúüÊúõÁöÑÁä∂ÊÄÅ
status: ËßÇÊµãÂà∞ÁöÑÁä∂ÊÄÅ
</code></pre>
<p>Êü•ÁúãapiVersion:</p>
<pre><code>kubectl api-versions
</code></pre>
<p>Êü•ÁúãKind:</p>
<pre><code>kubectl api-resources

# In a namespace
kubectl api-resources --namespaced=true

# Not in a namespace
kubectl api-resources --namespaced=false
</code></pre>
<p>metadata:</p>
<pre><code>metadata:

  name:
  namespace:

  labels/Ê†áÁ≠æ: Áî®Êà∑Á≠õÈÄâËµÑÊ∫êÔºåÂîØ‰∏ÄÁöÑËµÑÊ∫êÁªÑÂêàÊñπÊ≥ï, ÂèØ‰ª•‰ΩøÁî®selectorÊù•Êü•ËØ¢.

  annotations/Ê≥®Ëß£: Â≠òÂÇ®ËµÑÊ∫êÁöÑÈùûÊ†áËØÜÊÄß‰ø°ÊÅØÔºåÊâ©Â±ïËµÑÊ∫êÁöÑspec/status.

  ownerReference/ÂÖ≥Á≥ª: Êñπ‰æøÂèçÂêëÊü•ÊâæÂàõÂª∫ËµÑÊ∫êÁöÑÂØπË±°ÔºåÊñπ‰æøËøõË°åÁ∫ßËÅîÂà†Èô§„ÄÇ
</code></pre>
<p>spec:</p>
<p>status:</p>
<hr>
<h2 id="Ë∞ÉÂ∫¶Êä¢Âç†È©±ÈÄê">Ë∞ÉÂ∫¶ÔºåÊä¢Âç†ÔºåÈ©±ÈÄê</h2>
<p>taints: Ê±°ÁÇπÔºå‰ΩøËäÇÁÇπÊéíÊñ•ÁâπÂÆöpod„ÄÇÂ∫îÁî®‰∫énode„ÄÇÂä†‰∫ÜtolerationsÊàñËÄÖaffinityÁöÑpodÊâçËÉΩË∞ÉÂ∫¶ËøáÊù•„ÄÇ</p>
<pre><code>taints:
- effect: NoSchedule
  key: kubernetes.io/arch
  value: arm64
</code></pre>
<p>tolerations: ÂÆπÂøçÂ∫¶Ôºå‰ΩøpodËÉΩÂÆπÂøçÂä†‰∫ÜtraintsÁöÑËäÇÁÇπ„ÄÇÂ∫îÁî®‰∫épod„ÄÇ
Ëøô‰∏™Âè™ËÉΩËÆ©podËÉΩÈÉ®ÁΩ≤Âà∞Âä†‰∫ÜÊ±°ÁÇπÁöÑnodeÔºåpod‰πüËÉΩÈÉ®ÁΩ≤Âà∞ÂÖ∂ÂÆÉÊ≤°ÊúâÂä†Ê±°ÁÇπÁöÑnode„ÄÇ</p>
<pre><code>tolerations:
- key: &quot;kubernetes.io/arch&quot;
  operator: &quot;Equal&quot;/&quot;Exists&quot;
  value: &quot;arm64&quot;
  effect: &quot;NoSchedule&quot;/&quot;NoExecute&quot;
</code></pre>
<p>nodeAffinity: ËäÇÁÇπ‰∫≤ÂíåÊÄßÔºåÊåáÂÆöpodÂè™ËÉΩË∞ÉÂ∫¶Âà∞ÁâπÂÆönode‰∏ä„ÄÇÂ∫îÁî®‰∫épod„ÄÇ</p>
<pre><code>   affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: kubernetes.io/arch
            operator: In
            values:
            - arm64
</code></pre>
<p>podAffinity: pod‰∫≤ÂíåÊÄßÔºåÊåáÂÆöpodÂè™ËÉΩË∞ÉÂ∫¶Âà∞ÁâπÂÆönode‰∏ä„ÄÇÂ∫îÁî®‰∫épod„ÄÇÂ∏åÊúõÂèØ‰ª•ÂíåÂÖ∂ÂÆÉpodË∞ÉÂ∫¶Âà∞Âêå‰∏Ä‰∏™node‰∏ä„ÄÇ</p>
<pre><code>    affinity:
      podAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          labelSelector:
            matchExpressions:
            - key: app
              operator: In
              values:
              - nginx
          topologyKey: kubernetes.io/hostname
</code></pre>
<p>podAntiAffinity: podÂèç‰∫≤ÂíåÊÄßÔºåÊåáÂÆöpod‰∏çËÉΩË∞ÉÂ∫¶Âà∞ÁâπÂÆönode‰∏ä„ÄÇÂ∫îÁî®‰∫épod„ÄÇ‰∏çÂ∏åÊúõÂíåÂÖ∂ÂÆÉpodË∞ÉÂ∫¶Âà∞Âêå‰∏Ä‰∏™node‰∏ä„ÄÇ</p>
<pre><code>    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          labelSelector:
            matchExpressions:
            - key: app
              operator: In
              values:
              - nginx
          topologyKey: kubernetes.io/hostname
</code></pre>
<p>nodeSelector: ËäÇÁÇπÈÄâÊã©ÔºåpodÂè™ËÉΩË∞ÉÂ∫¶Âà∞ÁâπÂÆöËäÇÁÇπ„ÄÇ</p>
<pre><code> nodeSelector:
   kubernetes.io/arch: arm64
</code></pre>
<h2 id="ÂÆâÂÖ®">ÂÆâÂÖ®</h2>
<p>securityContextÁî®Êù•ÈÖçÁΩÆ Pod Êàñ ÂÆπÂô® ËøêË°åÊó∂ÁöÑÂÆâÂÖ®ÊÄßËÆæÁΩÆÁöÑÂ≠óÊÆµÔºåÂÆÉËÉΩÈôêÂà∂ÂÆπÂô®ÁöÑÊùÉÈôê„ÄÅÁî®Êà∑Ë∫´‰ªΩ„ÄÅÊñá‰ª∂Á≥ªÁªüËÆøÈóÆÁ≠âÔºå‰ªéËÄåÈôç‰ΩéÂÆπÂô®Ë¢´ÊîªÂáªÂêéÈÄ†ÊàêÁöÑÁ†¥ÂùèËåÉÂõ¥„ÄÇÂÆπÂô®Á∫ßÂà´‰ºòÂÖàÁ∫ßÈ´ò‰∫é Pod Á∫ßÂà´„ÄÇ</p>
<pre><code>securityContext:
  runAsUser: 1000
  runAsGroup: 3000
  fsGroup: 2000
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
    add:
    - NET_ADMIN
</code></pre>
<hr>
<h1 id="pod">Pod</h1>
<p>podÊ®°ÊùøÔºå ÈÄöÂ∏∏‰ΩøÁî®deployment, jobÂíåstatefulset, daemonsetÊù•ÁÆ°ÁêÜpod.</p>
<pre><code>// kubectl explain pod.spec
apiVersion: v1
kind: Pod
metadata:
  name: test
  namespace: test
  labels:
      app: test
spec:

  //// containers
  os:  // Êìç‰ΩúÁ≥ªÁªüÊ®°Êùø
    name:

  imagePullSecrets:  // ÁßÅÊúâÈïúÂÉèÊéàÊùÉ
  - name: my-harbor

  initContainers: //  initcontainerÊ®°Êùø
  - name: init
    image: my-image
    command: ...
    args: ...

  containers: // container Ê®°Êùø
  - name: test
    // image
    image: image
    imagePullPolicy: Always/IfNotPresent/Never

    // entrypoint
    command:
    args:
    workingDir:

    // port
    ports:

    // resources
    resources:
      requests:  // Áî≥ÊòéÈúÄË¶ÅÁöÑËµÑÊ∫ê
        memory: &quot;64Mi&quot;  // byte
        cpu: &quot;250m&quot;     // millicore (1 core = 1000 millicore)
        ephemeral-storage: &quot;2Gi&quot; // byte
      limits:
        memory: &quot;128Mi&quot;
        cpu: &quot;500m&quot;
        ephemeral-storage: &quot;4Gi&quot;

    // environment variables, ÈíàÂØπÂçï‰∏™ÈîÆÂÄºÂØπ.
    env:
    - name: key
      value: value
    - name: key
      valueFrom: // Â∞Ücm-name‰∏≠ÁöÑÂÄºcm-key‰º†Áªôkey
        configMapKeyRef:
          name: cm-name
          key: cm-key
          optional:
    - name: key
      valueFrom: // ÊåÇËΩΩsecret
        secretKeyRef:
          key:
          name:
          optional:
        fieldRef:
        resourceFieldRef:

    // ÁéØÂ¢ÉÂèòÈáèÔºåÈíàÂØπÊñá‰ª∂‰∏≠ÊâÄÊúâÈîÆÂÄºÂØπ.
    envFrom:
    - configMapRef    // Â∞Ümy-cm‰∏≠ÁöÑÊâÄÊúâÈîÆÂÄºÂØπÂèòÊàêÁéØÂ¢ÉÂèòÈáè.
        name: my-cm
        optional:
    - secretRef
        name: 
        optional:
     
    // volumeMounts (ÂéªVolumeÊâæÂØπÂ∫îËµÑÊ∫ê)
    // Â¶ÇÊûúÊ≤°ÊúâsubpathÔºåÊï¥‰∏™ÁõÆÂΩï‰ºöË¢´Ë¶ÜÁõñÔºåÁõÆÂΩï‰∏ãÂè™Êúâsecret/configmapÊåÇËΩΩÁöÑÊñá‰ª∂.
    volumeMounts: // secret‰ª•Êñá‰ª∂ÂΩ¢ÂºèÊåÇËΩΩÂà∞/etc/foo
    - name: my-secret
      mountPath: &quot;/etc/foo&quot; // ÊåÇËΩΩ‰πãÂêéË¶ÜÁõñÊï¥‰∏™ÁõÆÂΩï
      readOnly: true
    - name: my-configmap
      mountPath: &quot;/etc/bar&quot; // ÊåÇËΩΩ‰πãÂêéË¶ÜÁõñÊï¥‰∏™ÁõÆÂΩï
      // Â¶ÇÊûúÊúâsubpath, secret/configmapÈáåÁöÑdataÈáåÁöÑÊñá‰ª∂ÂêçÈúÄË¶Å‰∏ésubpathÂíåmountpathÊåáÂÆöÁöÑÊñá‰ª∂Âêç‰∏ÄËá¥.
    - name: config
      mountPath: /etc/app/app.conf  // ÊòØÊñá‰ª∂ÔºåÊñá‰ª∂ÂêçË¶ÅÂíåsubpath‰∏ÄËá¥„ÄÇ
      subPath: app.conf // ÊåÇËΩΩ‰πãÂêéÂè™Ë¶ÜÁõñÁõÆÂΩï‰∏≠ÂêåÂêçÊñá‰ª∂,ÂÖ∂ÂÆÉÊñá‰ª∂‰∏çÂΩ±Âìç.

    // lifecycle
    livenessProbe:
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      httpGet:
        path: /admin
        port: django
        # httpHeaders:
        # - name: Authorization
          # value: Basic $LDAP_ACCOUNT
    readinessProbe:
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      httpGet:
        path: /admin
        port: django
        # httpHeaders:
        # - name: Authorization
          # value: Basic $LDAP_ACCOUNT

    // securityContext
    securityContext:

    // debugging
    stdin: false
    stdinOnce: false
    tty: false

  //// security context
  securityContext: // podÁ∫ßÂà´security contextÂÆö‰πâ
    runAsuser: 1000
    runAsGroup: 3000
    fsGroup: 2000

  //// volumes
  volumes:
  - name: my-secret // ÊåáÂÆöË¶ÅÊåÇËΩΩÁöÑsecret
    secret:
      secretName: mysecret
  - name: my-configmap
    configMap:
      name: myconfigmap

  //// lifecycle
  restartPolicy:

  //// scheduling
  nodeName:
  nodeSelector: // Â∞ÜpodÈÉ®ÁΩ≤Âà∞ÊåáÂÆönode
    key: value
  affinity:
  tolerations:

  //// others
  hostname:
  hostNetwork:
  serviceAccountName:
</code></pre>
<p>pod‰∏≠ÁöÑcontainerÂÖ±‰∫´Â≠òÂÇ®(pod volume):</p>
<pre><code>apiVersion: v1
Kind: Pod
medadata:
spec:

  # ‰∏§Áßçpod volume
  volumes:
  # emptyDirÔºö podÂà†Èô§‰πãÂêéËØ•ÁõÆÂΩï‰πü‰ºöË¢´Âà†Èô§
  - name: cache-volume
    emptyDir: {}
  # hostPath: podÂà†Èô§‰πãÂêéËØ•ÁõÆÂΩïËøòÂú®host‰∏ä. 
  - name: hostpath-volume
    hostPath:
      path: /path/on/host

  containers:
  - name: container1
    image: test
    volumeMounts:
    - name: cache-volume
      mountpath: /path/on/container
      # subPath‰ºöÂú®emptyDirÊàñhostPathÁõÆÂΩï‰∏ãÂàõÂª∫Â≠êÁõÆÂΩï
      subPath: cache1
  - name: container2
    image: test
    volumeMounts:
    - name: hostpath-volume
      mountpath: /path/on/container
      readOnly: true
</code></pre>
<hr>
<h1 id="deployment">Deployment</h1>
<p>Áî®‰∫éÈÉ®ÁΩ≤Êó†Áä∂ÊÄÅÊúçÂä°„ÄÇ</p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app-deploy
  namespace: my-ns
  lables:
    app: my-app
spec:
  replicas: 3
  # ÈÄâÊã©Âô®
  selector: 
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: my-app
        image: image:latest
        imagePullPolicy: IfNotPresent/Always
        ports:
        - containerPort: 443
        volumeMounts:
        - name: my-hostpath
          mountPath: /path/on/cpod
        - name: my-pvc
          mountPath: /data 
      volumes:
      - name: my-hostpath
        hostPath: 
          path: /path/on/host
      - name: my-pvc
        persistentVolumeClaim:
          claimName: nfs-pvc
</code></pre>
<hr>
<h1 id="daemonset">DaemonSet</h1>
<p>ÊØè‰∏™node‰∏äÈÉ®ÁΩ≤‰∏Ä‰∏™stageless podÔºåÁî®‰∫éÈÉ®ÁΩ≤agent„ÄÇ</p>
<p>DaemonSet</p>
<pre><code>apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: my-ds
  namespace: my-ns
  labels:
    k8s-app: my-app
  spec:
    selector:
      matchLabels:
        name: my-app
    template:
      metadata:
        labels:
          name: my-app
      spec:
        containers:
        - name: my-container
          image: my-img
</code></pre>
<hr>
<h1 id="statefulset">StatefulSet</h1>
<p>Áî®‰∫éÈÉ®ÁΩ≤ÊúâÁä∂ÊÄÅÊúçÂä°„ÄÇ</p>
<p>StatefulSet ‰∏≠ÁöÑ Pod Êã•Êúâ‰∏Ä‰∏™ÂîØ‰∏ÄÁöÑÈ°∫Â∫èÁ¥¢ÂºïÂíåÁ®≥ÂÆöÁöÑÁΩëÁªúË∫´‰ªΩÊ†áËØÜ„ÄÇ</p>
<pre><code>apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: web
  namespace: test
  labels:
    k8s-app: my-app
spec:
  serviceName: &quot;nginx&quot;
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: k8s.gcr.io/nginx-slim:0.8
        ports:
        - containerPort: 80
          name: web
        volumeMounts:
        - name: www
          mountPath: /usr/share/nginx/html
  volumeClaimTemplates:
  - metadata:
      name: www
    spec:
      accessModes: [ &quot;ReadWriteOnce&quot; ]
      resources:
        requests:
          storage: 1Gi
</code></pre>
<hr>
<h1 id="job">Job</h1>
<p>Job</p>
<pre><code>appVersion: batch/v1
kind: Job
metadata:
  name: my-job
spec:
  # ‰ª£Ë°®Êú¨podÈòüÂàóÊâßË°åÊ≠§Ê¨°Êï∞(Ë¢´ÊâßË°å8Ê¨°)
  completions: 8
  # ‰ª£Ë°®Âπ∂Ë°åÊâßË°å‰∏™Êï∞(ÂêåÊó∂Êúâ‰∏§‰∏™Âú®ËøêË°å)
  parallelism: 2
  backoffLimit: 4
  template:
    spec:
      containers:
      - name: my-job
        image: my-image
        conmand: ['test']
      restartPolicy: Never
</code></pre>
<hr>
<h1 id="cronjob">CronJob</h1>
<p>CronJob</p>
<pre><code>apiVersion: batch/v1
kind: CronJob
metadata:
  name: my-cj
spec:
  schedule: &quot;* * * * *&quot;
  startingDeadlineSeconds: None(default)/10
  concurrencyPolicy: Allow(default)/Forbid/Replace
  suspend: false(default)/true
  successfulJobsHistoryLimit: 3(default)
  failedJobsHistoryLimit: 1(default)
  jobTemplate:
    spec:
      template:
        metadata:
          annotations: ...
          labels: ...
        spec:
          nodeSelector:
            ...
          imagePullSecrets:
            ...
          restartPolicy: OnFailure
          containers:
          - name: image
            image: image
            args:
            - /bin/sh
            - -c
            - date
</code></pre>
<hr>
<h1 id="configmap">ConfigMap</h1>
<p>configmapÂè™ËÉΩÂú®ÂΩìÂâçnamespace‰ΩøÁî®.</p>
<p>configmapÁöÑÈÖçÁΩÆÂú®pod‰∏≠Êó†Ê≥ï‰øÆÊîπÁªëÂÆöÁöÑÊñá‰ª∂.</p>
<p>dataÈáåÈù¢ÁöÑÊñá‰ª∂ÂêçÂ∞±ÊòØÊåÇËΩΩ‰πãÂêéÁöÑÊñá‰ª∂Âêç„ÄÇ</p>
<p>ConfigMap</p>
<pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app: flanel
    tier: node
  name: flannel-cfg
  namespace: kube-system
data:
  cni-conf.json: |
    {
      &quot;name&quot;: &quot;n1&quot;
    }
</code></pre>
<p>ÂàõÂª∫ÈÖçÁΩÆÊñá‰ª∂ÁöÑconfigmap</p>
<pre><code>$ kubectl -n app create cm my-conf --from-file ./config.ini -o yaml &gt; myconf-configmap.yaml
$ kubectl -n influxdata create cm dashboard-docker --from-file Docker.json -o yaml &gt; grafana-dashboard-docker-configmap.yaml
</code></pre>
<hr>
<h1 id="secret">Secret</h1>
<p>secretÂè™ËÉΩÂú®ÂΩìÂâçnamespace‰ΩøÁî®.</p>
<p>dataÈáåÁöÑÊñá‰ª∂ÂêçÂ∞±ÊòØÊåÇËΩΩ‰πãÂêéÁöÑÊñá‰ª∂Âêç„ÄÇ</p>
<p>OpaqueÊòØÁî®Êà∑Ëá™ÂÆö‰πâÊ†ºÂºè</p>
<p>generic secret</p>
<pre><code>kubectl create secret generic empty-secret

apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: mysecret
  namespace: kube-system
data:
  username: name 
  password: pw
</code></pre>
<p>ÂàõÂª∫tls secretË¥¶Âè∑:</p>
<pre><code>kubectl -n kubernetes-dashboard create secret tls \
kubernetes-dashboard-tls --key ca.key --cert ca.crt 
</code></pre>
<p>Á±ªÂûã‰∏∫ kubernetes.io/tls ÁöÑ Secret ‰∏≠ÂåÖÂê´ÂØÜÈí•ÂíåËØÅ‰π¶ÁöÑ DER Êï∞ÊçÆÔºå‰ª• Base64 Ê†ºÂºèÁºñÁ†Å„ÄÇ Â¶ÇÊûú‰Ω†ÁÜüÊÇâÁßÅÈí•ÂíåËØÅ‰π¶ÁöÑ PEM Ê†ºÂºèÔºåbase64 ‰∏éËØ•Ê†ºÂºèÁõ∏ÂêåÔºåÂè™ÊòØ‰Ω†ÈúÄË¶ÅÁï•Ëøá PEM Êï∞ÊçÆ‰∏≠ÊâÄÂåÖÂê´ÁöÑÁ¨¨‰∏ÄË°åÂíåÊúÄÂêé‰∏ÄË°å„ÄÇ</p>
<pre><code>apiVersion: v1
kind: Secret
metadata:
  name: secret-tls
type: kubernetes.io/tls
data:
  tls.crt: |
    MIIC2DCCAcCgAwIBAgIBATANBgkqh ...    
  tls.key: |
    MIIEpgIBAAKCAQEA7yn3bRHQ5FHMQ ...   
</code></pre>
<p>ÂàõÂª∫docker secret:</p>
<p>kubernetes.io/dockercfg	~/.dockercfg Êñá‰ª∂ÁöÑÂ∫èÂàóÂåñÂΩ¢Âºè</p>
<p>kubernetes.io/dockerconfigjson	~/.docker/config.json Êñá‰ª∂ÁöÑÂ∫èÂàóÂåñÂΩ¢Âºè</p>
<p>Áªô‰∏Ä‰∏™private registryÂàõÂª∫secret:</p>
<pre><code>$ kubectl -n ns create secret docker-registry &lt;name&gt; \
--docker-server=https://harbor.domain.com --docker-username=user --docker-password=pw --docker-email=canuxcheng@gmail.com 
</code></pre>
<p>Ê†πÊçÆÊú¨Âú∞ÁöÑÊñá‰ª∂ÂàõÂª∫secretÔºàÂ¶ÇÊûúÈúÄË¶ÅÂ§ö‰∏™registryÔºåÂèØ‰ª•ÂÖàÂú®Êú¨Âú∞ÁôªÈôÜÔºâ</p>
<pre><code>$ kubectl -n ns create secret generic regcred \
--from-file=.dockerconfigjson=$HOME/.docker/config.json \
--type=kubernetes.io/dockerconfigjson

apiVersion: v1
kind: Secret
metadata:
  name: artifactory-cred
  namespace: ...
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: ewoJImF1d......
</code></pre>
<hr>
<h1 id="service">Service</h1>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: grafana-service
  namespace: influxdata
spec:
  type: NodePort
  ports:
  - name: https
    port: 3000 // ÈõÜÁæ§ÂÜÖÈÉ®ËÆøÈóÆÁöÑport.
    targetPort: 3000 // podÊåáÂÆöÁöÑport.
    nodePort: 32000 // ÈõÜÁæ§Â§ñÈÉ®ËÆøÈóÆÂÜÖÈÉ®serviceÁöÑport.
  selector:   // ÂåπÈÖçËµÑÊ∫êÁöÑmetadata.labels
    app: grafana
</code></pre>
<h2 id="externalname-service">ExternalName Service</h2>
<p>ExternalName Service ÊòØ Service ÁöÑÁâπ‰æãÔºåÂÆÉÊ≤°ÊúâÈÄâÊã©ÁÆóÁ¨¶Ôºå‰ΩÜÊòØ‰ΩøÁî® DNS ÂêçÁß∞, Â∞ÜÊúçÂä°Êò†Â∞ÑÂà∞ DNS ÂêçÁß∞ÔºåËÄå‰∏çÊòØselector.</p>
<p>ËÆøÈóÆÂÖ∂ÂÆÉnamespaceÁöÑservice.</p>
<p>ÂΩìÊü•Êâæ‰∏ªÊú∫¬†my-service.my-ns.svc.cluster.local¬†Êó∂ÔºåÈõÜÁæ§ DNS ÊúçÂä°ËøîÂõû¬†CNAME¬†ËÆ∞ÂΩïÔºå ÂÖ∂ÂÄº‰∏∫¬†out-service.out-ns.svc.cluster.local„ÄÇ
ËÆøÈóÆ¬†my-service¬†ÁöÑÊñπÂºè‰∏éÂÖ∂‰ªñÊúçÂä°ÁöÑÊñπÂºèÁõ∏ÂêåÔºå‰ΩÜ‰∏ªË¶ÅÂå∫Âà´Âú®‰∫éÈáçÂÆöÂêëÂèëÁîüÂú® DNS Á∫ßÂà´ÔºåËÄå‰∏çÊòØÈÄöËøá‰ª£ÁêÜÊàñËΩ¨Âèë</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: my-service
  namespace: my-ns
spec:
  type: ExternalName
  externalName: out-service.out-ns.svc.cluster.local // ÊåáÂêëÂÖ∂ÂÆÉnamespaceÁöÑservice.
</code></pre>
<h2 id="endpoint">Endpoint</h2>
<p>‰∏ãÈù¢Âú∫ÊôØÂèØ‰ª•‰ΩøÁî®Endpoint.</p>
<ol>
<li>Â∏åÊúõÂú®Áîü‰∫ßÁéØÂ¢É‰∏≠‰ΩøÁî®Â§ñÈÉ®ÁöÑÊï∞ÊçÆÂ∫ìÈõÜÁæ§Ôºå‰ΩÜÊµãËØïÁéØÂ¢É‰ΩøÁî®Ëá™Â∑±ÁöÑÊï∞ÊçÆÂ∫ì„ÄÇ</li>
<li>Â∏åÊúõÊúçÂä°ÊåáÂêëÂè¶‰∏Ä‰∏™¬†ÂëΩÂêçÁ©∫Èó¥¬†‰∏≠ÊàñÂÖ∂ÂÆÉÈõÜÁæ§‰∏≠ÁöÑÊúçÂä°„ÄÇ</li>
<li>ÊÇ®Ê≠£Âú®Â∞ÜÂ∑•‰ΩúË¥üËΩΩËøÅÁßªÂà∞ Kubernetes„ÄÇ Âú®ËØÑ‰º∞ËØ•ÊñπÊ≥ïÊó∂ÔºåÊÇ®‰ªÖÂú® Kubernetes ‰∏≠ËøêË°å‰∏ÄÈÉ®ÂàÜÂêéÁ´Ø„ÄÇ</li>
</ol>
<p>ÂÖàÂàõÂª∫service:</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: mysql-service
  namespace: influxdata
spec:
  ports:
    - protocol: TCP
      port: 3306
      targetPort: 3306
</code></pre>
<p>ÂÜçÂàõÂª∫endpointÔºö</p>
<pre><code>apiVersion: v1
kind: Endpoints
metadata:
  name: mysql-service
  namespace: influxdata
subsets:
  - addresses:
      - ip: 10.103.X.X // ÊåáÂêëÂ§ñÈÉ®ÊúçÂä°ÁöÑIP
    ports:
      - port: 3306
</code></pre>
<hr>
<h1 id="hpa">HPA</h1>
<p>Horizontal Pod Autoscaler, Ê®™Âêë‰º∏Áº©„ÄÇ</p>
<pre><code>apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: 
  labels: 
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: d-name
  minReplicas: 2
  maxReplicas: 20
  metrics:
    - type: Resource
      resource:
        name: cpu
        targetAverageUtilization: 80
    - type: Resource
      resource:
        name: memory
        targetAverageUtilization: 80
</code></pre>
<hr>
<h1 id="authentication">Authentication</h1>
<p>ÈªòËÆ§ÁöÑClusterRoleÂíåClusterRoleBindingÂ§ßÈÉ®ÂàÜÊòØsystem:ÂºÄÂ§¥„ÄÇ</p>
<h2 id="serviceaccont">ServiceAccont</h2>
<p>ÊúçÂä°Ë¥¶Êà∑ÊòØÂú®ÂÖ∑‰ΩìÂêçÂ≠óÁ©∫Èó¥ÁöÑ„ÄÇ</p>
<pre><code>apiVersion: v1
kind: ServiceAccount
metadata:
  name: default
  namespace: default
</code></pre>
<p>1.22‰πãÂâçk8s‰ºöËá™Âä®ÁªôSAÂàõÂª∫token.</p>
<p>1.24‰πãÂêé‰ΩøÁî®TokenRequestËé∑ÂèñÊúâÊó∂Èó¥ÈôêÂà∂ÁöÑtoken„ÄÇ</p>
<p>ÂàõÂª∫ÊåÅ‰πÖÂåñtoken</p>
<pre><code>apiVersion: v1
kind: Secret
type: kubernetes.io/service-account-token
metadata:
  name: mysecretname
  annotations:
    kubernetes.io/service-account.name: myserviceaccount
</code></pre>
<h2 id="role">Role</h2>
<p>ÈÄöËøároleÊù•ÁªôÊåáÂÆönsÂÜÖÁöÑËµÑÊ∫êÊéàÊùÉ.</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: pod-reader
rules:
- apiGroups: [&quot;&quot;] # &quot;&quot; Ê†áÊòé core API ÁªÑ
  resources: [&quot;pods&quot;]
  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]
</code></pre>
<h2 id="rolebinding">RoleBinding</h2>
<p>Â∞ÜroleÊàñclusterroleÊùÉÈôêËµã‰∫àÂÖ∑‰ΩìÁöÑËßíËâ≤.</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
# Ê≠§ËßíËâ≤ÁªëÂÆöÂÖÅËÆ∏ &quot;jane&quot; ËØªÂèñ &quot;default&quot; ÂêçÂ≠óÁ©∫Èó¥‰∏≠ÁöÑ Pods
kind: RoleBinding
metadata:
  name: read-pods
  namespace: default
subjects:
# ‰Ω†ÂèØ‰ª•ÊåáÂÆö‰∏çÊ≠¢‰∏Ä‰∏™‚ÄúsubjectÔºà‰∏ª‰ΩìÔºâ‚Äù
- kind: User
  name: jane # &quot;name&quot; ÊòØÂå∫ÂàÜÂ§ßÂ∞èÂÜôÁöÑ
  apiGroup: rbac.authorization.k8s.io
roleRef:
  # &quot;roleRef&quot; ÊåáÂÆö‰∏éÊüê Role Êàñ ClusterRole ÁöÑÁªëÂÆöÂÖ≥Á≥ª
  kind: Role # Ê≠§Â≠óÊÆµÂøÖÈ°ªÊòØ Role Êàñ ClusterRole
  name: pod-reader     # Ê≠§Â≠óÊÆµÂøÖÈ°ª‰∏é‰Ω†Ë¶ÅÁªëÂÆöÁöÑ Role Êàñ ClusterRole ÁöÑÂêçÁß∞ÂåπÈÖç
  apiGroup: rbac.authorization.k8s.io
</code></pre>
<h2 id="clusterrole">ClusterRole</h2>
<p>clusterroleÁªôÊï¥‰∏™ÈõÜÁæ§ÊéàÊùÉ.‰∏çÈúÄË¶Ånamespace.</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  # &quot;namespace&quot; Ë¢´ÂøΩÁï•ÔºåÂõ†‰∏∫ ClusterRoles ‰∏çÂèóÂêçÂ≠óÁ©∫Èó¥ÈôêÂà∂
  name: secret-reader
rules:
- apiGroups: [&quot;&quot;]
  # Âú® HTTP Â±ÇÈù¢ÔºåÁî®Êù•ËÆøÈóÆ Secret ÂØπË±°ÁöÑËµÑÊ∫êÁöÑÂêçÁß∞‰∏∫ &quot;secrets&quot;
  resources: [&quot;secrets&quot;]
  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]
</code></pre>
<h2 id="clusterrolebinding">ClusterRoleBinding</h2>
<p>Ë∑®ÈõÜÁæ§ÊéàÊùÉÔºà‰πüÂ∞±ÊòØË¶ÅËÆøÈóÆ‰∏çÂêånsÁöÑËµÑÊ∫ê).‰∏çÈúÄË¶Ånamespace.</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
# Ê≠§ÈõÜÁæ§ËßíËâ≤ÁªëÂÆöÂÖÅËÆ∏ ‚Äúmanager‚Äù ÁªÑ‰∏≠ÁöÑ‰ªª‰Ωï‰∫∫ËÆøÈóÆ‰ªª‰ΩïÂêçÂ≠óÁ©∫Èó¥‰∏≠ÁöÑ secrets
kind: ClusterRoleBinding
metadata:
  name: read-secrets-global
subjects:
- kind: Group
  name: manager # 'name' ÊòØÂå∫ÂàÜÂ§ßÂ∞èÂÜôÁöÑ
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: secret-reader
  apiGroup: rbac.authorization.k8s.io
</code></pre>
<hr>
<h2 id="admission-controllers">Admission Controllers</h2>
<p>api access controlÊòØÈÄöËøáAdmission ControllersÊù•ÂÆûÁé∞ÁöÑ„ÄÇ</p>
<h3 id="mutatingadmissionwebhook">MutatingAdmissionWebhook</h3>
<h3 id="validatingadmissionwebhook">ValidatingAdmissionWebhook</h3>
<h3 id="validatingwebhookconfiguration">ValidatingWebhookConfiguration</h3>
<pre><code>apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  annotations:
    meta.helm.sh/release-name: ingress-nginx-internal
    meta.helm.sh/release-namespace: ingress-nginx
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx-internal
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.9.1
    helm.sh/chart: ingress-nginx-4.8.1
  name: ingress-nginx-internal-admission
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    caBundle: 
    service:
      name: ingress-nginx-internal-controller-admission
      namespace: ingress-nginx
      path: /networking/v1/ingresses
      port: 443
  failurePolicy: Fail
  matchPolicy: Equivalent
  name: validate.nginx.ingress.kubernetes.io
  namespaceSelector: {}
  objectSelector: {}
  rules:
  - apiGroups:
    - networking.k8s.io
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - ingresses
    scope: '*'
  sideEffects: None
  timeoutSeconds: 10
</code></pre>
<h3 id="mutatingwebhookconfiguration">MutatingWebhookConfiguration</h3>
<pre><code>apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  annotations:
    meta.helm.sh/release-name: vault-secrets-webhook
    meta.helm.sh/release-namespace: vault-secrets-webhook
  labels:
    app.kubernetes.io/managed-by: Helm
  name: vault-secrets-webhook
webhooks:
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    caBundle:
    service:
      name: vault-secrets-webhook
      namespace: vault-secrets-webhook
      path: /pods
      port: 443
  failurePolicy: Ignore
  matchPolicy: Equivalent
  name: pods.vault-secrets-webhook.admission.banzaicloud.com
  namespaceSelector:
    matchExpressions:
    - key: name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - vault-secrets-webhook
  objectSelector:
    matchExpressions:
    - key: security.banzaicloud.io/mutate
      operator: NotIn
      values:
      - skip
  reinvocationPolicy: Never
  rules:
  - apiGroups:
    - '*'
    apiVersions:
    - '*'
    operations:
    - CREATE
    resources:
    - pods
    scope: '*'
  sideEffects: NoneOnDryRun
  timeoutSeconds: 10
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    caBundle:
    service:
      name: vault-secrets-webhook
      namespace: vault-secrets-webhook
      path: /secrets
      port: 443
  failurePolicy: Ignore
  matchPolicy: Equivalent
  name: secrets.vault-secrets-webhook.admission.banzaicloud.com
  namespaceSelector:
    matchExpressions:
    - key: name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - vault-secrets-webhook
  objectSelector:
    matchExpressions:
    - key: owner
      operator: NotIn
      values:
      - helm
    - key: security.banzaicloud.io/mutate
      operator: NotIn
      values:
      - skip
  reinvocationPolicy: Never
  rules:
  - apiGroups:
    - '*'
    apiVersions:
    - '*'
    operations:
    - CREATE
    - UPDATE
    resources:
    - secrets
    scope: '*'
  sideEffects: NoneOnDryRun
  timeoutSeconds: 10
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    caBundle:
    service:
      name: vault-secrets-webhook
      namespace: vault-secrets-webhook
      path: /configmaps
      port: 443
  failurePolicy: Ignore
  matchPolicy: Equivalent
  name: configmaps.vault-secrets-webhook.admission.banzaicloud.com
  namespaceSelector:
    matchExpressions:
    - key: name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - vault-secrets-webhook
  objectSelector:
    matchExpressions:
    - key: owner
      operator: NotIn
      values:
      - helm
    - key: security.banzaicloud.io/mutate
      operator: NotIn
      values:
      - skip
  reinvocationPolicy: Never
  rules:
  - apiGroups:
    - '*'
    apiVersions:
    - '*'
    operations:
    - CREATE
    - UPDATE
    resources:
    - configmaps
    scope: '*'
  sideEffects: NoneOnDryRun
  timeoutSeconds: 10
</code></pre>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/k8s/">K8s</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css"integrity="sha256-J&#43;iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s="crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js"integrity="sha256-InsNdER1b2xUewP&#43;pKCUJpkhiqwHgqiPXDlIk7GzBu4="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js"integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

     
    
        
    <div id="gitalk-container"></div>
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"
/>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: "3d41a2a237fabe050cc0",
        clientSecret: "868aa81b294f1463ddb6edc007576ecfed7d2075",
        repo: "crazy-canux.github.io",
        owner: "crazy-canux",
        admin: ["crazy-canux"],
        distractionFreeMode: false, 
        id: md5(location.pathname), 
    });
    (function () {
        if (
            ["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1
        ) {
            document.getElementById("gitalk-container").innerHTML =
                "Gitalk comments not available by default when the website is previewed locally.";
            return;
        }
        gitalk.render("gitalk-container");
    })();
</script>



    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2013 - 
        
        2025 Morgoth
    </section>
    
    <section class="powerby">
        
            Designed by Canux <br/>
        
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
