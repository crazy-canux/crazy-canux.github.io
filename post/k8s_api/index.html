<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='API api-serverç»Ÿä¸€çš„æ“ä½œå…¥å£.
kubectl, UI, ç­‰éƒ½æ˜¯é€šè¿‡api-serveræ“ä½œèµ„æº.
payloadå¯ä»¥æ˜¯jsonï¼Œä¹Ÿå¯ä»¥æ˜¯yaml.
yamlæ–‡ä»¶ä¸­#è¡¨ç¤ºè¡Œæ³¨é‡Šã€‚
yaml éƒ¨ç½²k8så¯ä»¥é€šè¿‡yamlæ–‡ä»¶æ¥é…ç½®èµ„æº.
èµ„æºå¯¹è±¡ç»„æˆéƒ¨åˆ†:
apiVersion: kind: metadata: å…ƒæ•°æ® spec: æœŸæœ›çš„çŠ¶æ€ status: è§‚æµ‹åˆ°çš„çŠ¶æ€ æŸ¥çœ‹apiVersion:
kubectl api-versions æŸ¥çœ‹Kind:
kubectl api-resources # In a namespace kubectl api-resources --namespaced=true # Not in a namespace kubectl api-resources --namespaced=false metadata:
metadata: name: namespace: labels/æ ‡ç­¾: ç”¨æˆ·ç­›é€‰èµ„æºï¼Œå”¯ä¸€çš„èµ„æºç»„åˆæ–¹æ³•, å¯ä»¥ä½¿ç”¨selectoræ¥æŸ¥è¯¢. annotations/æ³¨è§£: å­˜å‚¨èµ„æºçš„éæ ‡è¯†æ€§ä¿¡æ¯ï¼Œæ‰©å±•èµ„æºçš„spec/status. ownerReference/å…³ç³»: æ–¹ä¾¿åå‘æŸ¥æ‰¾åˆ›å»ºèµ„æºçš„å¯¹è±¡ï¼Œæ–¹ä¾¿è¿›è¡Œçº§è”åˆ é™¤ã€‚ spec:
status:
è°ƒåº¦ï¼ŒæŠ¢å ï¼Œé©±é€ taints: æ±¡ç‚¹ï¼Œä½¿èŠ‚ç‚¹æ’æ–¥ç‰¹å®špodã€‚åº”ç”¨äºnodeã€‚åŠ äº†tolerationsæˆ–è€…affinityçš„podæ‰èƒ½è°ƒåº¦è¿‡æ¥ã€‚
taints: - effect: NoSchedule key: kubernetes.io/arch value: arm64 tolerations: å®¹å¿åº¦ï¼Œä½¿podèƒ½å®¹å¿åŠ äº†traintsçš„èŠ‚ç‚¹ã€‚åº”ç”¨äºpodã€‚ è¿™ä¸ªåªèƒ½è®©podèƒ½éƒ¨ç½²åˆ°åŠ äº†æ±¡ç‚¹çš„nodeï¼Œpodä¹Ÿèƒ½éƒ¨ç½²åˆ°å…¶å®ƒæ²¡æœ‰åŠ æ±¡ç‚¹çš„nodeã€‚
'>
<title>K8S API</title>

<link rel='canonical' href='https://canuxcheng.com/post/k8s_api/'>

<link rel="stylesheet" href="/scss/style.min.2d59822570c0be136f2ad87c952ef8788ac2a951067adda1c49b253bff7d0292.css"><meta property='og:title' content='K8S API'>
<meta property='og:description' content='API api-serverç»Ÿä¸€çš„æ“ä½œå…¥å£.
kubectl, UI, ç­‰éƒ½æ˜¯é€šè¿‡api-serveræ“ä½œèµ„æº.
payloadå¯ä»¥æ˜¯jsonï¼Œä¹Ÿå¯ä»¥æ˜¯yaml.
yamlæ–‡ä»¶ä¸­#è¡¨ç¤ºè¡Œæ³¨é‡Šã€‚
yaml éƒ¨ç½²k8så¯ä»¥é€šè¿‡yamlæ–‡ä»¶æ¥é…ç½®èµ„æº.
èµ„æºå¯¹è±¡ç»„æˆéƒ¨åˆ†:
apiVersion: kind: metadata: å…ƒæ•°æ® spec: æœŸæœ›çš„çŠ¶æ€ status: è§‚æµ‹åˆ°çš„çŠ¶æ€ æŸ¥çœ‹apiVersion:
kubectl api-versions æŸ¥çœ‹Kind:
kubectl api-resources # In a namespace kubectl api-resources --namespaced=true # Not in a namespace kubectl api-resources --namespaced=false metadata:
metadata: name: namespace: labels/æ ‡ç­¾: ç”¨æˆ·ç­›é€‰èµ„æºï¼Œå”¯ä¸€çš„èµ„æºç»„åˆæ–¹æ³•, å¯ä»¥ä½¿ç”¨selectoræ¥æŸ¥è¯¢. annotations/æ³¨è§£: å­˜å‚¨èµ„æºçš„éæ ‡è¯†æ€§ä¿¡æ¯ï¼Œæ‰©å±•èµ„æºçš„spec/status. ownerReference/å…³ç³»: æ–¹ä¾¿åå‘æŸ¥æ‰¾åˆ›å»ºèµ„æºçš„å¯¹è±¡ï¼Œæ–¹ä¾¿è¿›è¡Œçº§è”åˆ é™¤ã€‚ spec:
status:
è°ƒåº¦ï¼ŒæŠ¢å ï¼Œé©±é€ taints: æ±¡ç‚¹ï¼Œä½¿èŠ‚ç‚¹æ’æ–¥ç‰¹å®špodã€‚åº”ç”¨äºnodeã€‚åŠ äº†tolerationsæˆ–è€…affinityçš„podæ‰èƒ½è°ƒåº¦è¿‡æ¥ã€‚
taints: - effect: NoSchedule key: kubernetes.io/arch value: arm64 tolerations: å®¹å¿åº¦ï¼Œä½¿podèƒ½å®¹å¿åŠ äº†traintsçš„èŠ‚ç‚¹ã€‚åº”ç”¨äºpodã€‚ è¿™ä¸ªåªèƒ½è®©podèƒ½éƒ¨ç½²åˆ°åŠ äº†æ±¡ç‚¹çš„nodeï¼Œpodä¹Ÿèƒ½éƒ¨ç½²åˆ°å…¶å®ƒæ²¡æœ‰åŠ æ±¡ç‚¹çš„nodeã€‚
'>
<meta property='og:url' content='https://canuxcheng.com/post/k8s_api/'>
<meta property='og:site_name' content='Morgoth'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='k8s' /><meta property='article:published_time' content='2020-01-10T20:55:52&#43;08:00'/><meta property='article:modified_time' content='2020-01-10T20:55:52&#43;08:00'/>
<meta name="twitter:title" content="K8S API">
<meta name="twitter:description" content="API api-serverç»Ÿä¸€çš„æ“ä½œå…¥å£.
kubectl, UI, ç­‰éƒ½æ˜¯é€šè¿‡api-serveræ“ä½œèµ„æº.
payloadå¯ä»¥æ˜¯jsonï¼Œä¹Ÿå¯ä»¥æ˜¯yaml.
yamlæ–‡ä»¶ä¸­#è¡¨ç¤ºè¡Œæ³¨é‡Šã€‚
yaml éƒ¨ç½²k8så¯ä»¥é€šè¿‡yamlæ–‡ä»¶æ¥é…ç½®èµ„æº.
èµ„æºå¯¹è±¡ç»„æˆéƒ¨åˆ†:
apiVersion: kind: metadata: å…ƒæ•°æ® spec: æœŸæœ›çš„çŠ¶æ€ status: è§‚æµ‹åˆ°çš„çŠ¶æ€ æŸ¥çœ‹apiVersion:
kubectl api-versions æŸ¥çœ‹Kind:
kubectl api-resources # In a namespace kubectl api-resources --namespaced=true # Not in a namespace kubectl api-resources --namespaced=false metadata:
metadata: name: namespace: labels/æ ‡ç­¾: ç”¨æˆ·ç­›é€‰èµ„æºï¼Œå”¯ä¸€çš„èµ„æºç»„åˆæ–¹æ³•, å¯ä»¥ä½¿ç”¨selectoræ¥æŸ¥è¯¢. annotations/æ³¨è§£: å­˜å‚¨èµ„æºçš„éæ ‡è¯†æ€§ä¿¡æ¯ï¼Œæ‰©å±•èµ„æºçš„spec/status. ownerReference/å…³ç³»: æ–¹ä¾¿åå‘æŸ¥æ‰¾åˆ›å»ºèµ„æºçš„å¯¹è±¡ï¼Œæ–¹ä¾¿è¿›è¡Œçº§è”åˆ é™¤ã€‚ spec:
status:
è°ƒåº¦ï¼ŒæŠ¢å ï¼Œé©±é€ taints: æ±¡ç‚¹ï¼Œä½¿èŠ‚ç‚¹æ’æ–¥ç‰¹å®špodã€‚åº”ç”¨äºnodeã€‚åŠ äº†tolerationsæˆ–è€…affinityçš„podæ‰èƒ½è°ƒåº¦è¿‡æ¥ã€‚
taints: - effect: NoSchedule key: kubernetes.io/arch value: arm64 tolerations: å®¹å¿åº¦ï¼Œä½¿podèƒ½å®¹å¿åŠ äº†traintsçš„èŠ‚ç‚¹ã€‚åº”ç”¨äºpodã€‚ è¿™ä¸ªåªèƒ½è®©podèƒ½éƒ¨ç½²åˆ°åŠ äº†æ±¡ç‚¹çš„nodeï¼Œpodä¹Ÿèƒ½éƒ¨ç½²åˆ°å…¶å®ƒæ²¡æœ‰åŠ æ±¡ç‚¹çš„nodeã€‚
">
    <link rel="shortcut icon" href="favicon.ico" />
<style>
    :root {
        --article-font-family: "Merriweather", var(--base-font-family);
    }
</style>

<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap";
    
        customFont.type = "text/css";
        customFont.rel = "stylesheet";
    
        document.head.appendChild(customFont);
    }());
</script>

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/home_hu_ee27fe234e3b32c2.jpg" width="300"
                            height="400" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Morgoth</a></h1>
            <h2 class="site-description">Hello World!</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='mailto:canuxcheng@163.com'
                        target="_blank"
                        title="E-mail"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10" />
  <path d="M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://github.com/crazy-canux'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/categories/' target="_blank">
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                
                <span>Categories</span>
            </a>
        </li>
        
        
        <li >
            <a href='/tags/' target="_blank">
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



                
                <span>Tags</span>
            </a>
        </li>
        
        
        <li >
            <a href='/rtfm/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                
                <span>RTFM</span>
            </a>
        </li>
        
        
        <li >
            <a href='/samuel/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>



                
                <span>Samuel</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://canuxcheng.com/" selected></option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ul>
    <li><a href="#yaml">yaml</a></li>
    <li><a href="#è°ƒåº¦æŠ¢å é©±é€">è°ƒåº¦ï¼ŒæŠ¢å ï¼Œé©±é€</a></li>
    <li><a href="#å®‰å…¨">å®‰å…¨</a></li>
  </ul>

  <ul>
    <li><a href="#externalname-service">ExternalName Service</a></li>
    <li><a href="#endpoint">Endpoint</a></li>
  </ul>

  <ul>
    <li><a href="#serviceaccont">ServiceAccont</a></li>
    <li><a href="#role">Role</a></li>
    <li><a href="#rolebinding">RoleBinding</a></li>
    <li><a href="#clusterrole">ClusterRole</a></li>
    <li><a href="#clusterrolebinding">ClusterRoleBinding</a></li>
    <li><a href="#admission-controllers">Admission Controllers</a>
      <ul>
        <li><a href="#mutatingadmissionwebhook">MutatingAdmissionWebhook</a></li>
        <li><a href="#validatingadmissionwebhook">ValidatingAdmissionWebhook</a></li>
        <li><a href="#validatingwebhookconfiguration">ValidatingWebhookConfiguration</a></li>
        <li><a href="#mutatingwebhookconfiguration">MutatingWebhookConfiguration</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/cncf/" >
                CNCF
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/k8s_api/">K8S API</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 10, 2020</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="api">API</h1>
<p>api-serverç»Ÿä¸€çš„æ“ä½œå…¥å£.</p>
<p>kubectl, UI, ç­‰éƒ½æ˜¯é€šè¿‡api-serveræ“ä½œèµ„æº.</p>
<p>payloadå¯ä»¥æ˜¯jsonï¼Œä¹Ÿå¯ä»¥æ˜¯yaml.</p>
<p>yamlæ–‡ä»¶ä¸­#è¡¨ç¤ºè¡Œæ³¨é‡Šã€‚</p>
<hr>
<h2 id="yaml">yaml</h2>
<p>éƒ¨ç½²k8så¯ä»¥é€šè¿‡yamlæ–‡ä»¶æ¥é…ç½®èµ„æº.</p>
<p>èµ„æºå¯¹è±¡ç»„æˆéƒ¨åˆ†:</p>
<pre><code>apiVersion: 
kind: 
metadata: å…ƒæ•°æ®
spec: æœŸæœ›çš„çŠ¶æ€
status: è§‚æµ‹åˆ°çš„çŠ¶æ€
</code></pre>
<p>æŸ¥çœ‹apiVersion:</p>
<pre><code>kubectl api-versions
</code></pre>
<p>æŸ¥çœ‹Kind:</p>
<pre><code>kubectl api-resources

# In a namespace
kubectl api-resources --namespaced=true

# Not in a namespace
kubectl api-resources --namespaced=false
</code></pre>
<p>metadata:</p>
<pre><code>metadata:

  name:
  namespace:

  labels/æ ‡ç­¾: ç”¨æˆ·ç­›é€‰èµ„æºï¼Œå”¯ä¸€çš„èµ„æºç»„åˆæ–¹æ³•, å¯ä»¥ä½¿ç”¨selectoræ¥æŸ¥è¯¢.

  annotations/æ³¨è§£: å­˜å‚¨èµ„æºçš„éæ ‡è¯†æ€§ä¿¡æ¯ï¼Œæ‰©å±•èµ„æºçš„spec/status.

  ownerReference/å…³ç³»: æ–¹ä¾¿åå‘æŸ¥æ‰¾åˆ›å»ºèµ„æºçš„å¯¹è±¡ï¼Œæ–¹ä¾¿è¿›è¡Œçº§è”åˆ é™¤ã€‚
</code></pre>
<p>spec:</p>
<p>status:</p>
<hr>
<h2 id="è°ƒåº¦æŠ¢å é©±é€">è°ƒåº¦ï¼ŒæŠ¢å ï¼Œé©±é€</h2>
<p>taints: æ±¡ç‚¹ï¼Œä½¿èŠ‚ç‚¹æ’æ–¥ç‰¹å®špodã€‚åº”ç”¨äºnodeã€‚åŠ äº†tolerationsæˆ–è€…affinityçš„podæ‰èƒ½è°ƒåº¦è¿‡æ¥ã€‚</p>
<pre><code>taints:
- effect: NoSchedule
  key: kubernetes.io/arch
  value: arm64
</code></pre>
<p>tolerations: å®¹å¿åº¦ï¼Œä½¿podèƒ½å®¹å¿åŠ äº†traintsçš„èŠ‚ç‚¹ã€‚åº”ç”¨äºpodã€‚
è¿™ä¸ªåªèƒ½è®©podèƒ½éƒ¨ç½²åˆ°åŠ äº†æ±¡ç‚¹çš„nodeï¼Œpodä¹Ÿèƒ½éƒ¨ç½²åˆ°å…¶å®ƒæ²¡æœ‰åŠ æ±¡ç‚¹çš„nodeã€‚</p>
<pre><code>tolerations:
- key: &quot;kubernetes.io/arch&quot;
  operator: &quot;Equal&quot;/&quot;Exists&quot;
  value: &quot;arm64&quot;
  effect: &quot;NoSchedule&quot;/&quot;NoExecute&quot;
</code></pre>
<p>nodeAffinity: èŠ‚ç‚¹äº²å’Œæ€§ï¼ŒæŒ‡å®špodåªèƒ½è°ƒåº¦åˆ°ç‰¹å®šnodeä¸Šã€‚åº”ç”¨äºpodã€‚</p>
<pre><code>   affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
        - matchExpressions:
          - key: kubernetes.io/arch
            operator: In
            values:
            - arm64
</code></pre>
<p>podAffinity: podäº²å’Œæ€§ï¼ŒæŒ‡å®špodåªèƒ½è°ƒåº¦åˆ°ç‰¹å®šnodeä¸Šã€‚åº”ç”¨äºpodã€‚å¸Œæœ›å¯ä»¥å’Œå…¶å®ƒpodè°ƒåº¦åˆ°åŒä¸€ä¸ªnodeä¸Šã€‚</p>
<pre><code>    affinity:
      podAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          labelSelector:
            matchExpressions:
            - key: app
              operator: In
              values:
              - nginx
          topologyKey: kubernetes.io/hostname
</code></pre>
<p>podAntiAffinity: podåäº²å’Œæ€§ï¼ŒæŒ‡å®špodä¸èƒ½è°ƒåº¦åˆ°ç‰¹å®šnodeä¸Šã€‚åº”ç”¨äºpodã€‚ä¸å¸Œæœ›å’Œå…¶å®ƒpodè°ƒåº¦åˆ°åŒä¸€ä¸ªnodeä¸Šã€‚</p>
<pre><code>    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          labelSelector:
            matchExpressions:
            - key: app
              operator: In
              values:
              - nginx
          topologyKey: kubernetes.io/hostname
</code></pre>
<p>nodeSelector: èŠ‚ç‚¹é€‰æ‹©ï¼Œpodåªèƒ½è°ƒåº¦åˆ°ç‰¹å®šèŠ‚ç‚¹ã€‚</p>
<pre><code> nodeSelector:
   kubernetes.io/arch: arm64
</code></pre>
<h2 id="å®‰å…¨">å®‰å…¨</h2>
<p>securityContextç”¨æ¥é…ç½® Pod æˆ– å®¹å™¨ è¿è¡Œæ—¶çš„å®‰å…¨æ€§è®¾ç½®çš„å­—æ®µï¼Œå®ƒèƒ½é™åˆ¶å®¹å™¨çš„æƒé™ã€ç”¨æˆ·èº«ä»½ã€æ–‡ä»¶ç³»ç»Ÿè®¿é—®ç­‰ï¼Œä»è€Œé™ä½å®¹å™¨è¢«æ”»å‡»åé€ æˆçš„ç ´åèŒƒå›´ã€‚å®¹å™¨çº§åˆ«ä¼˜å…ˆçº§é«˜äº Pod çº§åˆ«ã€‚</p>
<pre><code>securityContext:
  runAsUser: 1000
  runAsGroup: 3000
  fsGroup: 2000
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
    add:
    - NET_ADMIN
</code></pre>
<hr>
<h1 id="pod">Pod</h1>
<p>podæ¨¡æ¿ï¼Œ é€šå¸¸ä½¿ç”¨deployment, jobå’Œstatefulset, daemonsetæ¥ç®¡ç†pod.</p>
<pre><code>// kubectl explain pod.spec
apiVersion: v1
kind: Pod
metadata:
  name: test
  namespace: test
  labels:
      app: test
spec:

  //// containers
  os:  // æ“ä½œç³»ç»Ÿæ¨¡æ¿
    name:

  imagePullSecrets:  // ç§æœ‰é•œåƒæˆæƒ
  - name: my-harbor

  initContainers: //  initcontaineræ¨¡æ¿
  - name: init
    image: my-image
    command: ...
    args: ...

  containers: // container æ¨¡æ¿
  - name: test
    // image
    image: image
    imagePullPolicy: Always/IfNotPresent/Never

    // entrypoint
    command:
    args:
    workingDir:

    // port
    ports:

    // resources
    resources:
      requests:  // ç”³æ˜éœ€è¦çš„èµ„æº
        memory: &quot;64Mi&quot;  // byte
        cpu: &quot;250m&quot;     // millicore (1 core = 1000 millicore)
        ephemeral-storage: &quot;2Gi&quot; // byte
      limits:
        memory: &quot;128Mi&quot;
        cpu: &quot;500m&quot;
        ephemeral-storage: &quot;4Gi&quot;

    // environment variables, é’ˆå¯¹å•ä¸ªé”®å€¼å¯¹.
    env:
    - name: key
      value: value
    - name: key
      valueFrom: // å°†cm-nameä¸­çš„å€¼cm-keyä¼ ç»™key
        configMapKeyRef:
          name: cm-name
          key: cm-key
          optional:
    - name: key
      valueFrom: // æŒ‚è½½secret
        secretKeyRef:
          key:
          name:
          optional:
        fieldRef:
        resourceFieldRef:

    // ç¯å¢ƒå˜é‡ï¼Œé’ˆå¯¹æ–‡ä»¶ä¸­æ‰€æœ‰é”®å€¼å¯¹.
    envFrom:
    - configMapRef    // å°†my-cmä¸­çš„æ‰€æœ‰é”®å€¼å¯¹å˜æˆç¯å¢ƒå˜é‡.
        name: my-cm
        optional:
    - secretRef
        name: 
        optional:
     
    // volumeMounts (å»Volumeæ‰¾å¯¹åº”èµ„æº)
    // å¦‚æœæ²¡æœ‰subpathï¼Œæ•´ä¸ªç›®å½•ä¼šè¢«è¦†ç›–ï¼Œç›®å½•ä¸‹åªæœ‰secret/configmapæŒ‚è½½çš„æ–‡ä»¶.
    volumeMounts: // secretä»¥æ–‡ä»¶å½¢å¼æŒ‚è½½åˆ°/etc/foo
    - name: my-secret
      mountPath: &quot;/etc/foo&quot; // æŒ‚è½½ä¹‹åè¦†ç›–æ•´ä¸ªç›®å½•
      readOnly: true
    - name: my-configmap
      mountPath: &quot;/etc/bar&quot; // æŒ‚è½½ä¹‹åè¦†ç›–æ•´ä¸ªç›®å½•
      // å¦‚æœæœ‰subpath, secret/configmapé‡Œçš„dataé‡Œçš„æ–‡ä»¶åéœ€è¦ä¸subpathå’ŒmountpathæŒ‡å®šçš„æ–‡ä»¶åä¸€è‡´.
    - name: config
      mountPath: /etc/app/app.conf  // æ˜¯æ–‡ä»¶ï¼Œæ–‡ä»¶åè¦å’Œsubpathä¸€è‡´ã€‚
      subPath: app.conf // æŒ‚è½½ä¹‹ååªè¦†ç›–ç›®å½•ä¸­åŒåæ–‡ä»¶,å…¶å®ƒæ–‡ä»¶ä¸å½±å“.

    // lifecycle
    livenessProbe:
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      httpGet:
        path: /admin
        port: django
        # httpHeaders:
        # - name: Authorization
          # value: Basic $LDAP_ACCOUNT
    readinessProbe:
      initialDelaySeconds: 10
      periodSeconds: 10
      timeoutSeconds: 5
      httpGet:
        path: /admin
        port: django
        # httpHeaders:
        # - name: Authorization
          # value: Basic $LDAP_ACCOUNT

    // securityContext
    securityContext:

    // debugging
    stdin: false
    stdinOnce: false
    tty: false

  //// security context
  securityContext: // podçº§åˆ«security contextå®šä¹‰
    runAsuser: 1000
    runAsGroup: 3000
    fsGroup: 2000

  //// volumes
  volumes:
  - name: my-secret // æŒ‡å®šè¦æŒ‚è½½çš„secret
    secret:
      secretName: mysecret
  - name: my-configmap
    configMap:
      name: myconfigmap

  //// lifecycle
  restartPolicy:

  //// scheduling
  nodeName:
  nodeSelector: // å°†podéƒ¨ç½²åˆ°æŒ‡å®šnode
    key: value
  affinity:
  tolerations:

  //// others
  hostname:
  hostNetwork:
  serviceAccountName:
</code></pre>
<p>podä¸­çš„containerå…±äº«å­˜å‚¨(pod volume):</p>
<pre><code>apiVersion: v1
Kind: Pod
medadata:
spec:

  # ä¸¤ç§pod volume
  volumes:
  # emptyDirï¼š podåˆ é™¤ä¹‹åè¯¥ç›®å½•ä¹Ÿä¼šè¢«åˆ é™¤
  - name: cache-volume
    emptyDir: {}
  # hostPath: podåˆ é™¤ä¹‹åè¯¥ç›®å½•è¿˜åœ¨hostä¸Š. 
  - name: hostpath-volume
    hostPath:
      path: /path/on/host

  containers:
  - name: container1
    image: test
    volumeMounts:
    - name: cache-volume
      mountpath: /path/on/container
      # subPathä¼šåœ¨emptyDiræˆ–hostPathç›®å½•ä¸‹åˆ›å»ºå­ç›®å½•
      subPath: cache1
  - name: container2
    image: test
    volumeMounts:
    - name: hostpath-volume
      mountpath: /path/on/container
      readOnly: true
</code></pre>
<hr>
<h1 id="deployment">Deployment</h1>
<p>ç”¨äºéƒ¨ç½²æ— çŠ¶æ€æœåŠ¡ã€‚</p>
<pre><code>apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-app-deploy
  namespace: my-ns
  lables:
    app: my-app
spec:
  replicas: 3
  # é€‰æ‹©å™¨
  selector: 
    matchLabels:
      app: my-app
  template:
    metadata:
      labels:
        app: my-app
    spec:
      containers:
      - name: my-app
        image: image:latest
        imagePullPolicy: IfNotPresent/Always
        ports:
        - containerPort: 443
        volumeMounts:
        - name: my-hostpath
          mountPath: /path/on/cpod
        - name: my-pvc
          mountPath: /data 
      volumes:
      - name: my-hostpath
        hostPath: 
          path: /path/on/host
      - name: my-pvc
        persistentVolumeClaim:
          claimName: nfs-pvc
</code></pre>
<hr>
<h1 id="daemonset">DaemonSet</h1>
<p>æ¯ä¸ªnodeä¸Šéƒ¨ç½²ä¸€ä¸ªstageless podï¼Œç”¨äºéƒ¨ç½²agentã€‚</p>
<p>DaemonSet</p>
<pre><code>apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: my-ds
  namespace: my-ns
  labels:
    k8s-app: my-app
  spec:
    selector:
      matchLabels:
        name: my-app
    template:
      metadata:
        labels:
          name: my-app
      spec:
        containers:
        - name: my-container
          image: my-img
</code></pre>
<hr>
<h1 id="statefulset">StatefulSet</h1>
<p>ç”¨äºéƒ¨ç½²æœ‰çŠ¶æ€æœåŠ¡ã€‚</p>
<p>StatefulSet ä¸­çš„ Pod æ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„é¡ºåºç´¢å¼•å’Œç¨³å®šçš„ç½‘ç»œèº«ä»½æ ‡è¯†ã€‚</p>
<pre><code>apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: web
  namespace: test
  labels:
    k8s-app: my-app
spec:
  serviceName: &quot;nginx&quot;
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: k8s.gcr.io/nginx-slim:0.8
        ports:
        - containerPort: 80
          name: web
        volumeMounts:
        - name: www
          mountPath: /usr/share/nginx/html
  volumeClaimTemplates:
  - metadata:
      name: www
    spec:
      accessModes: [ &quot;ReadWriteOnce&quot; ]
      resources:
        requests:
          storage: 1Gi
</code></pre>
<hr>
<h1 id="job">Job</h1>
<p>Job</p>
<pre><code>appVersion: batch/v1
kind: Job
metadata:
  name: my-job
spec:
  # ä»£è¡¨æœ¬podé˜Ÿåˆ—æ‰§è¡Œæ­¤æ¬¡æ•°(è¢«æ‰§è¡Œ8æ¬¡)
  completions: 8
  # ä»£è¡¨å¹¶è¡Œæ‰§è¡Œä¸ªæ•°(åŒæ—¶æœ‰ä¸¤ä¸ªåœ¨è¿è¡Œ)
  parallelism: 2
  backoffLimit: 4
  template:
    spec:
      containers:
      - name: my-job
        image: my-image
        conmand: ['test']
      restartPolicy: Never
</code></pre>
<hr>
<h1 id="cronjob">CronJob</h1>
<p>CronJob</p>
<pre><code>apiVersion: batch/v1
kind: CronJob
metadata:
  name: my-cj
spec:
  schedule: &quot;* * * * *&quot;
  startingDeadlineSeconds: None(default)/10
  concurrencyPolicy: Allow(default)/Forbid/Replace
  suspend: false(default)/true
  successfulJobsHistoryLimit: 3(default)
  failedJobsHistoryLimit: 1(default)
  jobTemplate:
    spec:
      template:
        metadata:
          annotations: ...
          labels: ...
        spec:
          nodeSelector:
            ...
          imagePullSecrets:
            ...
          restartPolicy: OnFailure
          containers:
          - name: image
            image: image
            args:
            - /bin/sh
            - -c
            - date
</code></pre>
<hr>
<h1 id="configmap">ConfigMap</h1>
<p>configmapåªèƒ½åœ¨å½“å‰namespaceä½¿ç”¨.</p>
<p>configmapçš„é…ç½®åœ¨podä¸­æ— æ³•ä¿®æ”¹ç»‘å®šçš„æ–‡ä»¶.</p>
<p>dataé‡Œé¢çš„æ–‡ä»¶åå°±æ˜¯æŒ‚è½½ä¹‹åçš„æ–‡ä»¶åã€‚</p>
<p>ConfigMap</p>
<pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  labels:
    app: flanel
    tier: node
  name: flannel-cfg
  namespace: kube-system
data:
  cni-conf.json: |
    {
      &quot;name&quot;: &quot;n1&quot;
    }
</code></pre>
<p>åˆ›å»ºé…ç½®æ–‡ä»¶çš„configmap</p>
<pre><code>$ kubectl -n app create cm my-conf --from-file ./config.ini -o yaml &gt; myconf-configmap.yaml
$ kubectl -n influxdata create cm dashboard-docker --from-file Docker.json -o yaml &gt; grafana-dashboard-docker-configmap.yaml
</code></pre>
<hr>
<h1 id="secret">Secret</h1>
<p>secretåªèƒ½åœ¨å½“å‰namespaceä½¿ç”¨.</p>
<p>dataé‡Œçš„æ–‡ä»¶åå°±æ˜¯æŒ‚è½½ä¹‹åçš„æ–‡ä»¶åã€‚</p>
<p>Opaqueæ˜¯ç”¨æˆ·è‡ªå®šä¹‰æ ¼å¼</p>
<p>generic secret</p>
<pre><code>kubectl create secret generic empty-secret

apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: mysecret
  namespace: kube-system
data:
  username: name 
  password: pw
</code></pre>
<p>åˆ›å»ºtls secretè´¦å·:</p>
<pre><code>kubectl -n kubernetes-dashboard create secret tls \
kubernetes-dashboard-tls --key ca.key --cert ca.crt 
</code></pre>
<p>ç±»å‹ä¸º kubernetes.io/tls çš„ Secret ä¸­åŒ…å«å¯†é’¥å’Œè¯ä¹¦çš„ DER æ•°æ®ï¼Œä»¥ Base64 æ ¼å¼ç¼–ç ã€‚ å¦‚æœä½ ç†Ÿæ‚‰ç§é’¥å’Œè¯ä¹¦çš„ PEM æ ¼å¼ï¼Œbase64 ä¸è¯¥æ ¼å¼ç›¸åŒï¼Œåªæ˜¯ä½ éœ€è¦ç•¥è¿‡ PEM æ•°æ®ä¸­æ‰€åŒ…å«çš„ç¬¬ä¸€è¡Œå’Œæœ€åä¸€è¡Œã€‚</p>
<pre><code>apiVersion: v1
kind: Secret
metadata:
  name: secret-tls
type: kubernetes.io/tls
data:
  tls.crt: |
    MIIC2DCCAcCgAwIBAgIBATANBgkqh ...    
  tls.key: |
    MIIEpgIBAAKCAQEA7yn3bRHQ5FHMQ ...   
</code></pre>
<p>åˆ›å»ºdocker secret:</p>
<p>kubernetes.io/dockercfg	~/.dockercfg æ–‡ä»¶çš„åºåˆ—åŒ–å½¢å¼</p>
<p>kubernetes.io/dockerconfigjson	~/.docker/config.json æ–‡ä»¶çš„åºåˆ—åŒ–å½¢å¼</p>
<p>ç»™ä¸€ä¸ªprivate registryåˆ›å»ºsecret:</p>
<pre><code>$ kubectl -n ns create secret docker-registry &lt;name&gt; \
--docker-server=https://harbor.domain.com --docker-username=user --docker-password=pw --docker-email=canuxcheng@gmail.com 
</code></pre>
<p>æ ¹æ®æœ¬åœ°çš„æ–‡ä»¶åˆ›å»ºsecretï¼ˆå¦‚æœéœ€è¦å¤šä¸ªregistryï¼Œå¯ä»¥å…ˆåœ¨æœ¬åœ°ç™»é™†ï¼‰</p>
<pre><code>$ kubectl -n ns create secret generic regcred \
--from-file=.dockerconfigjson=$HOME/.docker/config.json \
--type=kubernetes.io/dockerconfigjson

apiVersion: v1
kind: Secret
metadata:
  name: artifactory-cred
  namespace: ...
type: kubernetes.io/dockerconfigjson
data:
  .dockerconfigjson: ewoJImF1d......
</code></pre>
<hr>
<h1 id="service">Service</h1>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: grafana-service
  namespace: influxdata
spec:
  type: NodePort
  ports:
  - name: https
    port: 3000 // é›†ç¾¤å†…éƒ¨è®¿é—®çš„port.
    targetPort: 3000 // podæŒ‡å®šçš„port.
    nodePort: 32000 // é›†ç¾¤å¤–éƒ¨è®¿é—®å†…éƒ¨serviceçš„port.
  selector:   // åŒ¹é…èµ„æºçš„metadata.labels
    app: grafana
</code></pre>
<h2 id="externalname-service">ExternalName Service</h2>
<p>ExternalName Service æ˜¯ Service çš„ç‰¹ä¾‹ï¼Œå®ƒæ²¡æœ‰é€‰æ‹©ç®—ç¬¦ï¼Œä½†æ˜¯ä½¿ç”¨ DNS åç§°, å°†æœåŠ¡æ˜ å°„åˆ° DNS åç§°ï¼Œè€Œä¸æ˜¯selector.</p>
<p>è®¿é—®å…¶å®ƒnamespaceçš„service.</p>
<p>å½“æŸ¥æ‰¾ä¸»æœºÂ my-service.my-ns.svc.cluster.localÂ æ—¶ï¼Œé›†ç¾¤ DNS æœåŠ¡è¿”å›Â CNAMEÂ è®°å½•ï¼Œ å…¶å€¼ä¸ºÂ out-service.out-ns.svc.cluster.localã€‚
è®¿é—®Â my-serviceÂ çš„æ–¹å¼ä¸å…¶ä»–æœåŠ¡çš„æ–¹å¼ç›¸åŒï¼Œä½†ä¸»è¦åŒºåˆ«åœ¨äºé‡å®šå‘å‘ç”Ÿåœ¨ DNS çº§åˆ«ï¼Œè€Œä¸æ˜¯é€šè¿‡ä»£ç†æˆ–è½¬å‘</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: my-service
  namespace: my-ns
spec:
  type: ExternalName
  externalName: out-service.out-ns.svc.cluster.local // æŒ‡å‘å…¶å®ƒnamespaceçš„service.
</code></pre>
<h2 id="endpoint">Endpoint</h2>
<p>ä¸‹é¢åœºæ™¯å¯ä»¥ä½¿ç”¨Endpoint.</p>
<ol>
<li>å¸Œæœ›åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å¤–éƒ¨çš„æ•°æ®åº“é›†ç¾¤ï¼Œä½†æµ‹è¯•ç¯å¢ƒä½¿ç”¨è‡ªå·±çš„æ•°æ®åº“ã€‚</li>
<li>å¸Œæœ›æœåŠ¡æŒ‡å‘å¦ä¸€ä¸ªÂ å‘½åç©ºé—´Â ä¸­æˆ–å…¶å®ƒé›†ç¾¤ä¸­çš„æœåŠ¡ã€‚</li>
<li>æ‚¨æ­£åœ¨å°†å·¥ä½œè´Ÿè½½è¿ç§»åˆ° Kubernetesã€‚ åœ¨è¯„ä¼°è¯¥æ–¹æ³•æ—¶ï¼Œæ‚¨ä»…åœ¨ Kubernetes ä¸­è¿è¡Œä¸€éƒ¨åˆ†åç«¯ã€‚</li>
</ol>
<p>å…ˆåˆ›å»ºservice:</p>
<pre><code>apiVersion: v1
kind: Service
metadata:
  name: mysql-service
  namespace: influxdata
spec:
  ports:
    - protocol: TCP
      port: 3306
      targetPort: 3306
</code></pre>
<p>å†åˆ›å»ºendpointï¼š</p>
<pre><code>apiVersion: v1
kind: Endpoints
metadata:
  name: mysql-service
  namespace: influxdata
subsets:
  - addresses:
      - ip: 10.103.X.X // æŒ‡å‘å¤–éƒ¨æœåŠ¡çš„IP
    ports:
      - port: 3306
</code></pre>
<hr>
<h1 id="hpa">HPA</h1>
<p>Horizontal Pod Autoscaler, æ¨ªå‘ä¼¸ç¼©ã€‚</p>
<pre><code>apiVersion: autoscaling/v2beta2
kind: HorizontalPodAutoscaler
metadata:
  name: 
  labels: 
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: d-name
  minReplicas: 2
  maxReplicas: 20
  metrics:
    - type: Resource
      resource:
        name: cpu
        targetAverageUtilization: 80
    - type: Resource
      resource:
        name: memory
        targetAverageUtilization: 80
</code></pre>
<hr>
<h1 id="authentication">Authentication</h1>
<p>é»˜è®¤çš„ClusterRoleå’ŒClusterRoleBindingå¤§éƒ¨åˆ†æ˜¯system:å¼€å¤´ã€‚</p>
<h2 id="serviceaccont">ServiceAccont</h2>
<p>æœåŠ¡è´¦æˆ·æ˜¯åœ¨å…·ä½“åå­—ç©ºé—´çš„ã€‚</p>
<pre><code>apiVersion: v1
kind: ServiceAccount
metadata:
  name: default
  namespace: default
</code></pre>
<p>1.22ä¹‹å‰k8sä¼šè‡ªåŠ¨ç»™SAåˆ›å»ºtoken.</p>
<p>1.24ä¹‹åä½¿ç”¨TokenRequestè·å–æœ‰æ—¶é—´é™åˆ¶çš„tokenã€‚</p>
<p>åˆ›å»ºæŒä¹…åŒ–token</p>
<pre><code>apiVersion: v1
kind: Secret
type: kubernetes.io/service-account-token
metadata:
  name: mysecretname
  annotations:
    kubernetes.io/service-account.name: myserviceaccount
</code></pre>
<h2 id="role">Role</h2>
<p>é€šè¿‡roleæ¥ç»™æŒ‡å®šnså†…çš„èµ„æºæˆæƒ.</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  namespace: default
  name: pod-reader
rules:
- apiGroups: [&quot;&quot;] # &quot;&quot; æ ‡æ˜ core API ç»„
  resources: [&quot;pods&quot;]
  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]
</code></pre>
<h2 id="rolebinding">RoleBinding</h2>
<p>å°†roleæˆ–clusterroleæƒé™èµ‹äºˆå…·ä½“çš„è§’è‰².</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
# æ­¤è§’è‰²ç»‘å®šå…è®¸ &quot;jane&quot; è¯»å– &quot;default&quot; åå­—ç©ºé—´ä¸­çš„ Pods
kind: RoleBinding
metadata:
  name: read-pods
  namespace: default
subjects:
# ä½ å¯ä»¥æŒ‡å®šä¸æ­¢ä¸€ä¸ªâ€œsubjectï¼ˆä¸»ä½“ï¼‰â€
- kind: User
  name: jane # &quot;name&quot; æ˜¯åŒºåˆ†å¤§å°å†™çš„
  apiGroup: rbac.authorization.k8s.io
roleRef:
  # &quot;roleRef&quot; æŒ‡å®šä¸æŸ Role æˆ– ClusterRole çš„ç»‘å®šå…³ç³»
  kind: Role # æ­¤å­—æ®µå¿…é¡»æ˜¯ Role æˆ– ClusterRole
  name: pod-reader     # æ­¤å­—æ®µå¿…é¡»ä¸ä½ è¦ç»‘å®šçš„ Role æˆ– ClusterRole çš„åç§°åŒ¹é…
  apiGroup: rbac.authorization.k8s.io
</code></pre>
<h2 id="clusterrole">ClusterRole</h2>
<p>clusterroleç»™æ•´ä¸ªé›†ç¾¤æˆæƒ.ä¸éœ€è¦namespace.</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  # &quot;namespace&quot; è¢«å¿½ç•¥ï¼Œå› ä¸º ClusterRoles ä¸å—åå­—ç©ºé—´é™åˆ¶
  name: secret-reader
rules:
- apiGroups: [&quot;&quot;]
  # åœ¨ HTTP å±‚é¢ï¼Œç”¨æ¥è®¿é—® Secret å¯¹è±¡çš„èµ„æºçš„åç§°ä¸º &quot;secrets&quot;
  resources: [&quot;secrets&quot;]
  verbs: [&quot;get&quot;, &quot;watch&quot;, &quot;list&quot;]
</code></pre>
<h2 id="clusterrolebinding">ClusterRoleBinding</h2>
<p>è·¨é›†ç¾¤æˆæƒï¼ˆä¹Ÿå°±æ˜¯è¦è®¿é—®ä¸åŒnsçš„èµ„æº).ä¸éœ€è¦namespace.</p>
<pre><code>apiVersion: rbac.authorization.k8s.io/v1
# æ­¤é›†ç¾¤è§’è‰²ç»‘å®šå…è®¸ â€œmanagerâ€ ç»„ä¸­çš„ä»»ä½•äººè®¿é—®ä»»ä½•åå­—ç©ºé—´ä¸­çš„ secrets
kind: ClusterRoleBinding
metadata:
  name: read-secrets-global
subjects:
- kind: Group
  name: manager # 'name' æ˜¯åŒºåˆ†å¤§å°å†™çš„
  apiGroup: rbac.authorization.k8s.io
roleRef:
  kind: ClusterRole
  name: secret-reader
  apiGroup: rbac.authorization.k8s.io
</code></pre>
<hr>
<h2 id="admission-controllers">Admission Controllers</h2>
<p>api access controlæ˜¯é€šè¿‡Admission Controllersæ¥å®ç°çš„ã€‚</p>
<h3 id="mutatingadmissionwebhook">MutatingAdmissionWebhook</h3>
<h3 id="validatingadmissionwebhook">ValidatingAdmissionWebhook</h3>
<h3 id="validatingwebhookconfiguration">ValidatingWebhookConfiguration</h3>
<pre><code>apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  annotations:
    meta.helm.sh/release-name: ingress-nginx-internal
    meta.helm.sh/release-namespace: ingress-nginx
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx-internal
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.9.1
    helm.sh/chart: ingress-nginx-4.8.1
  name: ingress-nginx-internal-admission
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    caBundle: 
    service:
      name: ingress-nginx-internal-controller-admission
      namespace: ingress-nginx
      path: /networking/v1/ingresses
      port: 443
  failurePolicy: Fail
  matchPolicy: Equivalent
  name: validate.nginx.ingress.kubernetes.io
  namespaceSelector: {}
  objectSelector: {}
  rules:
  - apiGroups:
    - networking.k8s.io
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - ingresses
    scope: '*'
  sideEffects: None
  timeoutSeconds: 10
</code></pre>
<h3 id="mutatingwebhookconfiguration">MutatingWebhookConfiguration</h3>
<pre><code>apiVersion: admissionregistration.k8s.io/v1
kind: MutatingWebhookConfiguration
metadata:
  annotations:
    meta.helm.sh/release-name: vault-secrets-webhook
    meta.helm.sh/release-namespace: vault-secrets-webhook
  labels:
    app.kubernetes.io/managed-by: Helm
  name: vault-secrets-webhook
webhooks:
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    caBundle:
    service:
      name: vault-secrets-webhook
      namespace: vault-secrets-webhook
      path: /pods
      port: 443
  failurePolicy: Ignore
  matchPolicy: Equivalent
  name: pods.vault-secrets-webhook.admission.banzaicloud.com
  namespaceSelector:
    matchExpressions:
    - key: name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - vault-secrets-webhook
  objectSelector:
    matchExpressions:
    - key: security.banzaicloud.io/mutate
      operator: NotIn
      values:
      - skip
  reinvocationPolicy: Never
  rules:
  - apiGroups:
    - '*'
    apiVersions:
    - '*'
    operations:
    - CREATE
    resources:
    - pods
    scope: '*'
  sideEffects: NoneOnDryRun
  timeoutSeconds: 10
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    caBundle:
    service:
      name: vault-secrets-webhook
      namespace: vault-secrets-webhook
      path: /secrets
      port: 443
  failurePolicy: Ignore
  matchPolicy: Equivalent
  name: secrets.vault-secrets-webhook.admission.banzaicloud.com
  namespaceSelector:
    matchExpressions:
    - key: name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - vault-secrets-webhook
  objectSelector:
    matchExpressions:
    - key: owner
      operator: NotIn
      values:
      - helm
    - key: security.banzaicloud.io/mutate
      operator: NotIn
      values:
      - skip
  reinvocationPolicy: Never
  rules:
  - apiGroups:
    - '*'
    apiVersions:
    - '*'
    operations:
    - CREATE
    - UPDATE
    resources:
    - secrets
    scope: '*'
  sideEffects: NoneOnDryRun
  timeoutSeconds: 10
- admissionReviewVersions:
  - v1beta1
  clientConfig:
    caBundle:
    service:
      name: vault-secrets-webhook
      namespace: vault-secrets-webhook
      path: /configmaps
      port: 443
  failurePolicy: Ignore
  matchPolicy: Equivalent
  name: configmaps.vault-secrets-webhook.admission.banzaicloud.com
  namespaceSelector:
    matchExpressions:
    - key: name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - kube-system
    - key: kubernetes.io/metadata.name
      operator: NotIn
      values:
      - vault-secrets-webhook
  objectSelector:
    matchExpressions:
    - key: owner
      operator: NotIn
      values:
      - helm
    - key: security.banzaicloud.io/mutate
      operator: NotIn
      values:
      - skip
  reinvocationPolicy: Never
  rules:
  - apiGroups:
    - '*'
    apiVersions:
    - '*'
    operations:
    - CREATE
    - UPDATE
    resources:
    - configmaps
    scope: '*'
  sideEffects: NoneOnDryRun
  timeoutSeconds: 10
</code></pre>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/k8s/">K8s</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.css"integrity="sha256-J&#43;iAE0sgH8QSz9hpcDxXIftnj65JEZgNhGcgReTTK9s="crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/katex.min.js"integrity="sha256-InsNdER1b2xUewP&#43;pKCUJpkhiqwHgqiPXDlIk7GzBu4="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.15.6/dist/contrib/auto-render.min.js"integrity="sha256-y39Mpg7V3D4lhBX4x6O0bUqTV4pSrfgwEfGKfxkOdgI="crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

     
    
        
    <div id="gitalk-container"></div>
<link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css"
/>
<script src="https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js"></script>
<script>
    const gitalk = new Gitalk({
        clientID: "3d41a2a237fabe050cc0",
        clientSecret: "868aa81b294f1463ddb6edc007576ecfed7d2075",
        repo: "crazy-canux.github.io",
        owner: "crazy-canux",
        admin: ["crazy-canux"],
        distractionFreeMode: false, 
        id: md5(location.pathname), 
    });
    (function () {
        if (
            ["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1
        ) {
            document.getElementById("gitalk-container").innerHTML =
                "Gitalk comments not available by default when the website is previewed locally.";
            return;
        }
        gitalk.render("gitalk-container");
    })();
</script>



    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2013 - 
        
        2025 Morgoth
    </section>
    
    <section class="powerby">
        
            Designed by Canux <br/>
        
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
