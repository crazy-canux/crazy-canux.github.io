<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coreutils - Morgoth</title>
    <meta name="description" content="">
    
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: #fff;
            padding: 1rem 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 2rem;
        }
        nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        nav a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
        }
        nav a:hover {
            color: #007acc;
        }
        .site-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007acc;
        }
        main {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .post-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .post-content h1, .post-content h2, .post-content h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        .post-list {
            list-style: none;
            padding: 0;
        }
        .post-list li {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .post-list h2 {
            margin: 0 0 0.5rem 0;
        }
        .post-list h2 a {
            text-decoration: none;
            color: #333;
        }
        .post-list h2 a:hover {
            color: #007acc;
        }
        footer {
            text-align: center;
            padding: 2rem 0;
            color: #666;
            border-top: 1px solid #ddd;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="https://canuxcheng.com/" class="site-title">Morgoth</a>
                
                    <a href="/">Home</a>
                
                    <a href="/about/">About</a>
                
                    <a href="/categories/">Categories</a>
                
                    <a href="/tags/">Tags</a>
                
                    <a href="/rtfm/">RTFM</a>
                
                    <a href="/samuel/">Samuel</a>
                
            </nav>
        </div>
    </header>
    
    <div class="container">
        <main>
            
<div class="single-post">
    <article>
        <header>
            <h1>Coreutils</h1>
            <div class="post-meta">
                <time>March 31, 2016</time>
                
                    
                        <span class="category">Linux</span>
                    
                
                
                    
                        <span class="tag">#shell</span>
                    
                
            </div>
        </header>
        
        <div class="post-content">
            <h1 id="linux的外部命令">Linux的外部命令</h1>
<p>Linux外部命令的项目是coreutils。</p>
<p>外部命令在coreutils目录中</p>
<p>查看外部命令所在目录：</p>
<pre><code>echo $PATH
</code></pre>
<p>外部命令在下列目录中：</p>
<pre><code>~/bin # 用户自定义

/sbin

/bin

/usr/sbin

/usr/bin

/usr/local/sbin

/usr/local/bin

/usr/games

/usr/local/games
</code></pre>
<p>查看外部命令手册的在线手册：</p>
<pre><code>man [command]
info [command]
</code></pre>
<p>自定义外部命令：</p>
<p>添加$PATH变量，然后放到该目录。</p>
<hr>
<h1 id="系统管理">系统管理</h1>
<p>cpu/mem/load</p>
<pre><code># 查看cpu/mem/swap/system信息
vmstat
vmstat 1

# 查看进程消耗的cpu/mem/swap/system等系统信息
top
top -H  # 查看线程
%cpu = cputime/realtime * 100%
cpu_usage = %cpu/cpu-number
%mem = RES/physicalMem * 100%

htop
$ sudo apt-get install htop

$ sudo apt-get install sysstat (包括pidstat)
pidstat -u -p pid // cpu
pidstat -r -p pid //mem
</code></pre>
<p>cpu/load:</p>
<pre><code>$ sudo apt-get install sysstat (包括mpstat)
mpstat -P ALL 1 5 // cpu

uptime

lscpu # 显示cpu架构的信息

cat /proc/cpuinfo # 查看cpu信息
cat /proc/cpuinfo | grep &quot;processor&quot; | wc -l # 逻辑cpu总数
cat /proc/cpuinfo | grep &quot;physical id&quot; | sort | uniq | wc -l # 物理cpu个数
cat /proc/cpuinfo | grep &quot;cpu cores&quot; | uniq # 物理cpu核数
cat /proc/cpuinfo | grep -e &quot;cpu cores&quot;  -e &quot;siblings&quot; | sort | uniq # 和cpu cores一样说明没有启用超线程.
processor: 逻辑cpu总数=物理cpu个数*物理cpu核数（非超线程），  物理cpu个数*物理cpu核数*2（超线程cpu).
physical id :物理cpu个数(每个socket/插槽可以放一个物理cpu).
cpu cores: 物理cpu有几个核(如果是超线程技术的cpu,每个核可以运行两个线程，或者说每个核对应两个逻辑cpu）。
siblings： 每个物理cpu单个核心上的逻辑cpu个数

strace
strace -c -p pid
strace -T -e epoll_wait -p pid

dmesg
</code></pre>
<p>mem:</p>
<pre><code>free
free -m

cat /proc/meminfo # 查看内存信息

pmap
pmap -d pid
</code></pre>
<p>system:</p>
<pre><code>uname # 打印linux系统信息
$ uname -a
cat /etc/issue
cat /proc/version

lsb_release # 查看发行版本信息
$ lsb_release -a

getconf # 查询系统配置的变量，LONG_BIT表示系统位数
</code></pre>
<p>process:</p>
<pre><code>ps
# 格式化输出，逗号后面不能有空格
ps -eo/-Ao %cpu/pcpu,%mem/pmem,stat,start/start_time/lstart,pid,ppid,cmd/args/command
ps --ppid 1 -o pid,command | grep -v grep | grep daemon # 获取多进程程序主进程的pid

pstree -a

pkill
pkill -f &lt;pattern&gt; # 杀死args匹配的进程

pgrep -P pid

# 内核也有一个kill命令
kill

killall
killall -e &lt;deamon&gt; # 杀死匹配的守护进程.
</code></pre>
<p>crontab:</p>
<pre><code>$ sudo apt-get install cron
# /etc/crontab 设置了环境变量
crontab
crontab -l # 列出
crontab -e # 编辑
crontab -u &lt;user&gt; file # 导入配置/etc/cron.d/my-cron-file
</code></pre>
<p>editor:</p>
<pre><code># 修改默认编辑器nano
select-editor
</code></pre>
<p>时区管理</p>
<pre><code>timedatectl list-timezones # 查看所有时区
sudo timedatectl set-timezone Asia/Shanghai # 设置时区
ls -l /etc/localtime # 应该是一个链接
</code></pre>
<p>update-alternatives:</p>
<pre><code>update-alternatives --display python // 查看候选项
update-alternatives --config python // 选择候选项
update-alternatives --set python /usr/bin/python // 添加候选项
update-alternatives --install /usr/bin/python python /usr/bin/python3.7 1 // 设置候选项的link
update-alternatives --remove python /usr/bin/python3.5 // 删除候选项的link
</code></pre>
<h1 id="用户和权限管理">用户和权限管理</h1>
<pre><code>id
id -u 打印当前用户uid(root uid=0)
</code></pre>
<p>chmod:</p>
<pre><code># 当文件的owner的x位置为s,表示设置了SUID, 仅对二进制可执行文件有效.
# 如果执行者对该文件有可执行权限，那么执行者在执行该文件期间，就拥有了该文件的owner的权限.
-rwsr-xr-x file
chmod u+s &lt;file&gt; # 加SUID
chmod 4777 &lt;file&gt;

-rwxr-sr-x file/dir
chmod g+s &lt;file&gt;/&lt;dir&gt; # 加SGID
chmod 2777 &lt;dir&gt;

drwxrwxrwt dir
chmod o+t &lt;dir&gt; # 加SBIT
chmod 1777 &lt;dir&gt;

chown
chgrp
chattr
</code></pre>
<p>usermod</p>
<pre><code># 禁止root登录
usermod --shell /sbin/nologin root
</code></pre>
<p>adduser:</p>
<pre><code>adduser 

addgroup
</code></pre>
<p>useradd:</p>
<pre><code>useradd
useradd -r -m -U -G sudo -s /bin/bash &lt;user&gt;
-U, --user-group      create a group with the same name as the user
-m, --create-home     create the user's home directory
-s, --shell SHELL     login shell of the new account
-r, --system          create a system account
-G, --groups GROUPS   list of supplementary groups of the new account

userdel

usermod
usermod -G g1,g2 -a user // 将用户追加到组

users # 查看当前登陆的用户

groupadd
groupdel
groupmod

groups # 查看指定用户所属的组，默认当前用户的组
</code></pre>
<p>gpasswd:</p>
<pre><code>$ gpasswd -d &lt;user&gt; &lt;group&gt; // 从组里删除用户
</code></pre>
<p>chpasswd:</p>
<pre><code>echo &quot;username:password&quot; | chpasswd # 修改username的密码
</code></pre>
<p>passwd</p>
<pre><code>passwd
</code></pre>
<p>su:</p>
<pre><code>su &lt;user&gt; -c &lt;command&gt;
</code></pre>
<p>sudo:</p>
<pre><code>sudo -i
</code></pre>
<h1 id="文件和目录管理">文件和目录管理</h1>
<pre><code>mkdir
tree
cat
col
colrm
comm
csplit
ed
ex
fmt
fold
join
look
mtype
pico
sort
tr
expr
uniq
wc

cksum
cmp
diff
diffstat
file
cut
less
more
locate
lsattr
mattrib
mdel
mdir
mktemp
mmove
mren
mtools
mtoolstest
mv
od
paste
patch
rcp
rm
split

touch
umask
which
cp
whereis
mcopy
mshowfat
lprm
lpr
lpq
rev
toilet
aafire
xeyes
pv
yes
cal
factor
</code></pre>
<p>typeset</p>
<pre><code>typeset -u VAR // 变量大写
VAR='test'
echo $VAR # TEST

typeset -l VAR // 变量小写
</code></pre>
<p>tee</p>
<pre><code>main &gt; 2&gt;&amp;1 log1.log | tee log2.log # 同时重定向到两个文件
main 2&gt;&amp;1 | tee ${LOG} # 同时将stdout和stderr输出到终端和日志文件.
$ echo &quot;content&quot; | sudo tee filename # 写入到root权限的文件
$ echo &quot;text&quot; | sudo tee -a filename # append
</code></pre>
<p>lsof查看打开的文件资源:</p>
<pre><code>lsof #
lsof -i # 查看
sudo lsof -i :port # 查看端口是否被使用
</code></pre>
<p>readlink:</p>
<pre><code>readlink 获取符号连接信息
sudo readlink /proc/1/exe
</code></pre>
<p>ln:</p>
<pre><code>ln TARGET LINK_NAME # 创建文件的硬链接,目录不能创建硬链接
-s, --symbolic
ln -s TARGET LINK_NAME # 创建文件或目录的软链接
</code></pre>
<p>dirname:</p>
<pre><code>dirname
dirname $0   # 获取当前文件所在目录的相对路径, 也就是.
$(cd $(dirname $0) &amp;&amp; pwd)    # 获取当前文件所在目录的绝对路径
</code></pre>
<p>rsync:</p>
<pre><code>rsync
rsync [OPTION]... SRC [SRC]... DEST
rsync [OPTION]... SRC [SRC]... [USER@]HOST:DEST
rsync [OPTION]... [USER@]HOST:SRC [DEST]
rsync -rtvzuOPH --delete
-e &quot;ssh -o StrictHostKeyChecking=no&quot;
-v verbose
-a archive == -rlptgoD
-u --update # 跳过目的地址上modification time更新的文件
--inplace
--append
--append-verify
-r --recursive
-z --compress
--progress
--partial
-P == --partial --progress
--devices
--specials
-D == --devices --specials
-H --hard-links  preserve hard-link
-l --links  copy symlinks as symlinks 保留软链接
-L          copy symlinks to dest 复制原始文件
--delete  从dest删除src没有的文件
-h --human-readable
-g --group  preserve group
-o --owner  preserve owner
-p --perms  preserve permissions
-t --times  preserve modification times
-O, --omit-dir-times    忽略目录的modification times.
--exclude 排除文件
</code></pre>
<p>计算文件空间使用:</p>
<pre><code>du
$ du -sh
</code></pre>
<p>四个用到正则表达式的重要命令：</p>
<pre><code>sed
awk
grep/ack/ag
find
</code></pre>
<h1 id="压缩备份">压缩备份</h1>
<p>tar(.tar)</p>
<pre><code>tar
-c, --create   # 创建归档
-u, --update    # 更新归档文件
-x, --extract, --get    # 提取归档

tar cvf name.tar folder
tar xvf name.tar

compression options:
-j, --bzip2
-J, --xz
-z, --gzip, --gunzip, --ungzip
-Z, --compress, --uncompress

device selection and switching:
-f, --file=ARCHIVE

informative output:
-v, --verbose
</code></pre>
<p>gzip(.gz)</p>
<pre><code>gzip
gunzip
tar zxvf file.tar.gz
tar zcvf file.tar.gz dir
</code></pre>
<p>bzip2(.bz2)</p>
<pre><code>bzip2
bunzip2
tar jxvf file.tar.bz2
tar jcvf file.tar.bz2 dir
</code></pre>
<p>compress(.z)</p>
<pre><code>compress
uncompress
tar Zxvf file.tar.z
</code></pre>
<p>xz(.xz)</p>
<pre><code>xz
unxz
tar Jxvf file.tar.xz
</code></pre>
<p>gzip/gunzip</p>
<pre><code>gunzip name.gz
gzip -d name.gz
</code></pre>
<p>zip(.zip)</p>
<pre><code>zip
unzip
</code></pre>
<p>7z(.7z)</p>
<pre><code>$ sudo apt-get install p7zip/p7zip-full/p7zip-rar
7z
</code></pre>
<h1 id="数据处理">数据处理</h1>
<p>base64</p>
<pre><code>// 生成basic authentication.
echo -n &quot;user:pw&quot; | base64
</code></pre>

        </div>
    </article>
</div>

        </main>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Morgoth. Designed by Canux</p>
        </div>
    </footer>
</body>
</html>
