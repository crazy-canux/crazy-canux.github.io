<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Model - Morgoth</title>
    <meta name="description" content="">
    
    
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: #fff;
            padding: 1rem 0;
            border-bottom: 1px solid #ddd;
            margin-bottom: 2rem;
        }
        nav {
            display: flex;
            gap: 2rem;
            align-items: center;
        }
        nav a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
        }
        nav a:hover {
            color: #007acc;
        }
        .site-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #007acc;
        }
        main {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .post-meta {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .post-content h1, .post-content h2, .post-content h3 {
            margin-top: 2rem;
            margin-bottom: 1rem;
        }
        .post-list {
            list-style: none;
            padding: 0;
        }
        .post-list li {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #eee;
        }
        .post-list h2 {
            margin: 0 0 0.5rem 0;
        }
        .post-list h2 a {
            text-decoration: none;
            color: #333;
        }
        .post-list h2 a:hover {
            color: #007acc;
        }
        footer {
            text-align: center;
            padding: 2rem 0;
            color: #666;
            border-top: 1px solid #ddd;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <a href="https://canuxcheng.com/" class="site-title">Morgoth</a>
                
                    <a href="/">Home</a>
                
                    <a href="/about/">About</a>
                
                    <a href="/categories/">Categories</a>
                
                    <a href="/tags/">Tags</a>
                
                    <a href="/rtfm/">RTFM</a>
                
                    <a href="/samuel/">Samuel</a>
                
            </nav>
        </div>
    </header>
    
    <div class="container">
        <main>
            
<div class="single-post">
    <article>
        <header>
            <h1>Model</h1>
            <div class="post-meta">
                <time>October 4, 2016</time>
                
                    
                        <span class="category">Django</span>
                    
                
                
                    
                        <span class="tag">#model</span>
                    
                
            </div>
        </header>
        
        <div class="post-content">
            <h1 id="modelspy">models.py</h1>
<pre><code>from django.db import models
</code></pre>
<p>django模型是和数据库关联的，代码放在models.py，数据库信息在settings.py中统一配置即可。</p>
<p>每个模型对应数据库唯一的一张表，是django.db.models.Model的子类。</p>
<p>每个模型实例代表数据库中的一条特定记录.</p>
<p>模型的每个属性都表示为数据库中的一个字段。</p>
<ul>
<li>
<p>在项目的settings.py中激活应用，并设置数据库相关参数。</p>
</li>
<li>
<p>让django包含你的应用：</p>
<p>告诉django你对模型做了更改，并且将这些更改存储为迁移文件polls/migrations/0001_initial.py:</p>
<pre><code>  $python manage.py makemigrations polls
</code></pre>
<p>可以查看迁移文件执行了哪些sql语句,并不真的在数据库执行：</p>
<pre><code>  $python manage.py sqlmigrate polls 0001
</code></pre>
<p>可以检查项目中的模型是否存在问题：</p>
<pre><code>  $python manage.py check
</code></pre>
<p>在数据库中创建模型,查找还没有被应用的迁移文件然后和数据库同步：</p>
<pre><code>  $python manage.py migrate
</code></pre>
</li>
</ul>
<hr>
<h1 id="模型的字段类型和字段选项">模型的字段类型和字段选项</h1>
<p>模型的每个属性都表示为数据库的一个字段,是Field子类的某个实例。</p>
<p>模型的字段还有一些选项。</p>
<p>字段命名规则：</p>
<ol>
<li>不能是python的保留关键字。</li>
<li>字段名中连续的下划线不能超过一个。</li>
</ol>
<p>访问其它应用的模型,导入即可：</p>
<pre><code>from &lt;other-aplication&gt;.models import &lt;module-name&gt;
</code></pre>
<p>模型字段类型和选项参考：</p>
<p><a href="http://python.usyiyi.cn/documents/django_182/ref/models/fields.html#common-model-field-options">http://python.usyiyi.cn/documents/django_182/ref/models/fields.html#common-model-field-options</a></p>
<h2 id="模型字段类型">模型字段类型</h2>
<p>字段的类型都是Field类的子类：</p>
<p>每个字段都接受一个可选的位置参数(一般是第一个），叫字段的自述名,如果不指定就默认是字段名字（下划线换成空格）。</p>
<p>自增字段:</p>
<pre><code>AutoField
# 默认django会每个模型添加一个自增主键字段,如果你显示设置一个自增主键字段就不会默认再添加,每个模型只能有一个主键字段。
# id = models.AutoField(primary_key=True)
</code></pre>
<p>普通字段:</p>
<pre><code>BigIntegerField
BinaryField
BooleanField
CharField
CommaSeparatedIntegerField
DateField
DateTimeField
DecimalField
DurationField
EmailField
FileField
FilePathField
FloatField
GenericIPAddressField
IPAddressField
ImageField
IntegerField
NullBooleanField
PositiveIntegerField
PositiveSmallIntegerField
SlugField
SmallIntegerField
TextField
TimeField
URLField
UUIDField
</code></pre>
<p>关系字段:</p>
<p>django定义了一系列字段类型描述数据库之间的关联:</p>
<p>这三个字段要求第一个参数是模型类，用verbose_name选项才能指定自述名。</p>
<pre><code>ForeignKey 定义多对一关系
OneToOneField 定义一对一关系
ManyToManyField 定义多对多关系
</code></pre>
<h2 id="模型字段选项">模型字段选项</h2>
<p>django定义的字段的通用的选项：</p>
<p>每个字段都有特定的选项，也有通用的选项,特定参数参考文档。</p>
<pre><code>Field.null    django将空值以NULL存储到数据库中,默认是false
Field.blank    该字段允许为空白,默认false
Field.primary_key    true表示该字段为模型的主键字段,默认是false
Field.unique    true表示该字段在表中必须有唯一值,默认是false
Field.unique_for_date
Field.unique_for_month
Field.unique_for_year
Field.choices    可迭代结构,给字段提供选项
Field.default    该字段默认值
Field.help_text    额外的help文本
Field.editable    false表示该字段不会出现在admin,默认是true
Field.error_messages    重写默认抛出的错误信息
Field.verbose_name    该字段可读性更高的名称
Field.validators    该字段要运行的一个Validator的列表
Field.db_column
Field.db_index
Field.db_tablespace
</code></pre>
<hr>
<h1 id="模型元选项">模型元选项</h1>
<p>使用内部类Meta定义模型的元数据。</p>
<p>模型元数据是任何不是字段的数据，比如排序选项等。</p>
<pre><code>from django.db import models
class Ox(models.Model):
    horn_length = models.IntegerField()
    ...
    class Meta:
        ordering = [&quot;horn_length&quot;]
        verbose_name_plural = &quot;oxen&quot;
</code></pre>
<p>模型的元选项：</p>
<p><a href="http://python.usyiyi.cn/translate/django_182/ref/models/options.html">http://python.usyiyi.cn/translate/django_182/ref/models/options.html</a></p>
<p>在元类Meta中使用的选项.</p>
<pre><code>Options.abstract = True 表示模型是抽象基类, 数据库不会创建这个表
Options.db_table 该模型所用的数据表的名称
Options.db_tablespace
Options.default_related_name
Options.get_latest_by
Options.managed
Options.order_with_respect_to
Options.ordering = ['字段名', '-字段名'] 对象的默认顺序, -表示倒序
Options.permissions
Options.default_permissions
Options.proxy
Options.select_on_save
Options.unique_together
Options.index_together
Options.verbose_name 对象的一个易于理解的名字
Options.verbose_name_plural 该对象复数形式的名字
</code></pre>
<hr>
<h1 id="模型的属性">模型的属性</h1>
<p>模型的属性是表级别的,是对表的操作.</p>
<p><a href="http://python.usyiyi.cn/translate/django_182/ref/models/class.html">http://python.usyiyi.cn/translate/django_182/ref/models/class.html</a></p>
<p>每个模型类都要添加一个Manager实例,如果不显示添加，django就会默认添加objects属性，包含Manager实例。</p>
<p>Manager或object属性是模型进行数据库查询操作的接口,也叫管理器,用于从数据库获取实例。</p>
<pre><code>from django.db import models
class Foo(models.Model):
    # 显示添加
    bar = models.Manager()
</code></pre>
<hr>
<h1 id="执行查询">执行查询</h1>
<p>一旦建立数据模型,django会自动生成一套抽象的API,用于创建,检索,更新和删除对象.</p>
<h2 id="创建对象">创建对象</h2>
<pre><code>q = Question(question_text='content', pub_date='date')
q.save()

q = Question(question_text='content')
q.pub_date='date'
q.save()

Question.objects.create(question_text=&quot;content&quot;, pub_date='date')

# 防止重复,不存在就创建，返回(object, True),存在返回(object, False)
Question.objects.get_or_create(question_text='content', pub_date='date')
</code></pre>
<h2 id="获取对象">获取对象</h2>
<p>通过模型中的管理器构造一个查询集来从数据库获取对象.</p>
<p>查询集求值：</p>
<ol>
<li>迭代</li>
<li>切片</li>
<li>序列化</li>
<li>repr()</li>
<li>len()</li>
<li>list()</li>
<li>bool()</li>
</ol>
<p>查询集参考QuerySet类的方法：</p>
<p><a href="http://python.usyiyi.cn/translate/django_182/ref/models/querysets.html#queryset-api">http://python.usyiyi.cn/translate/django_182/ref/models/querysets.html#queryset-api</a></p>
<pre><code># 获取表中所有对象
Question.objects.all()
# 切片获取部分
Question.objects.all()[:10]
# 获取单个
Question.objects.get(question_text='content')
# 过滤
Question.objects.filter(**kwargs)
Question.objects.exclude(**kwargs)
</code></pre>
<p>查询集的链式过滤：</p>
<pre><code>Question.objects.all().exists()
Question.objects.all().order_by('name')
Question.objects.filter(**kwargs).filter(**kwargs)
</code></pre>
<hr>
<h1 id="模型的方法">模型的方法</h1>
<p>模型的方法是对模型的实例的操作.</p>
<p>模型中可以自定义方法，可以使用预定义的自动生成的方法，也可以覆盖预定义的方法。</p>
<p>预定义方法参考：</p>
<p><a href="http://python.usyiyi.cn/translate/django_182/ref/models/instances.html">http://python.usyiyi.cn/translate/django_182/ref/models/instances.html</a></p>
<pre><code>Model.__unicode__()
</code></pre>
<p>python2需要使用__unicode__方法.</p>
<pre><code>def __unicode__(self):
    return u'%s' % self.title

Model.__str__()
</code></pre>
<p>python3只需要__str__方法.</p>
<pre><code>def __str__(self):
    return '%s' % self.title
</code></pre>
<p>这段代码兼容python2和python3.</p>
<p>python_2_unicode_compatible是一个用于类的装饰器，在类中定义__str__并返回文本.</p>
<pre><code>from __future__ import unicode_literals
from django.utils.encoding import python_2_unicode_compatible

@python_2_unicode_compatible
class Question(models.Model):
    title = models.CharField('title', max_length=256)
    ...

    def __str__(self):
        return self.title

Model.__eq__()

Model.__hash__()

Model.get_absolute_url()

Model.get_FOO_display()

Model.get_next_by_FOO(**kwargs)

Model.get_previous_by_FOO(**kwargs)

Model.DoesNotExist
</code></pre>

        </div>
    </article>
</div>

        </main>
    </div>
    
    <footer>
        <div class="container">
            <p>&copy; 2025 Morgoth. Designed by Canux</p>
        </div>
    </footer>
</body>
</html>
